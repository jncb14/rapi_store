<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoodleCost | Costing Management of Sales</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --mint: #b8e0d2;
            --blush: #f5cac3;
            --ivory: #f7f7f7;
            --soft-gray: #e9ecef;
            --dark-gray: #495057;
            --primary: #6c757d;
            --success: #95d5b2;
            --info: #90e0ef;
            --warning: #ffd166;
            --danger: #ff9b85;
            
            /* Dark mode variables */
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #e0e0e0;
            --dark-border: #333333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
        }
        
        body {
            font-family: 'Poppins', 'Noto Sans KR', sans-serif;
            background-color: var(--ivory);
            color: var(--dark-gray);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding-top: 56px;
            transition: all 0.3s ease;
        }
        
        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
        .korean-theme {
            background-color: var(--ivory);
        }
        
        .dark-mode .korean-theme {
            background-color: var(--dark-bg);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--dark-gray) !important;
        }
        
        .dark-mode .navbar {
            background-color: var(--dark-card) !important;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .dark-mode .navbar-brand {
            color: var(--dark-text) !important;
        }
        
        .dark-mode .nav-link {
            color: var(--dark-text) !important;
        }
        
        .sidebar {
            background-color: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            padding: 20px 0;
            transition: all 0.3s ease;
            height: calc(100vh - 120px);
            overflow-y: auto;
            position: sticky;
            top: 80px;
        }
        
        .dark-mode .sidebar {
            background-color: var(--dark-card);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar .nav-link {
            color: var(--dark-gray);
            padding: 12px 20px;
            margin: 5px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .dark-mode .sidebar .nav-link {
            color: var(--dark-text);
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--mint);
            color: #333;
        }
        
        .dark-mode .sidebar .nav-link:hover, .dark-mode .sidebar .nav-link.active {
            background-color: #2a4d3f;
            color: var(--dark-text);
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 20px;
            background-color: white;
        }
        
        .dark-mode .card {
            background-color: var(--dark-card);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid var(--soft-gray);
            border-radius: 12px 12px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }
        
        .dark-mode .card-header {
            background-color: var(--dark-card);
            border-bottom: 1px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        .kpi-card {
            text-align: center;
            padding: 20px 15px;
        }
        
        .kpi-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .kpi-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .dark-mode .kpi-label {
            color: #a0a0a0;
        }
        
        .revenue { color: var(--success); }
        .cost { color: var(--danger); }
        .profit { color: var(--info); }
        .sales { color: var(--warning); }
        
        .btn-primary {
            background-color: var(--mint);
            border-color: var(--mint);
            color: #333;
        }
        
        .btn-primary:hover {
            background-color: #a1d4c1;
            border-color: #a1d4c1;
            color: #333;
        }
        
        .dark-mode .btn-primary {
            background-color: #2a4d3f;
            border-color: #2a4d3f;
            color: var(--dark-text);
        }
        
        .dark-mode .btn-primary:hover {
            background-color: #3a6d5d;
            border-color: #3a6d5d;
        }
        
        .btn-danger {
            background-color: var(--danger);
            border-color: var(--danger);
        }
        
        .dark-mode .btn-outline-secondary {
            border-color: #555;
            color: #aaa;
        }
        
        .dark-mode .btn-outline-secondary:hover {
            background-color: #555;
            color: var(--dark-text);
        }
        
        .table {
            border-radius: 10px;
            overflow: hidden;
            background-color: white;
        }
        
        .dark-mode .table {
            background-color: var(--dark-card);
            color: var(--dark-text);
        }
        
        .table th {
            background-color: var(--soft-gray);
            border: none;
            font-weight: 600;
        }
        
        .dark-mode .table th {
            background-color: #2a2a2a;
            color: var(--dark-text);
        }
        
        .table td {
            border: none;
            padding: 12px 15px;
        }
        
        .dark-mode .table td {
            border-bottom: 1px solid var(--dark-border);
        }
        
        .table tbody tr {
            transition: background-color 0.2s ease;
        }
        
        .table tbody tr:hover {
            background-color: rgba(184, 224, 210, 0.2);
        }
        
        .dark-mode .table tbody tr:hover {
            background-color: rgba(42, 77, 63, 0.3);
        }
        
        .toast {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .dark-mode .toast {
            background-color: var(--dark-card);
            color: var(--dark-text);
        }
        
        .dark-mode .toast-header {
            background-color: #2a2a2a;
            color: var(--dark-text);
            border-bottom: 1px solid var(--dark-border);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            border: 1px solid var(--soft-gray);
            padding: 10px 15px;
            background-color: white;
            color: var(--dark-gray);
        }
        
        .dark-mode .form-control, .dark-mode .form-select {
            background-color: #2a2a2a;
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--mint);
            box-shadow: 0 0 0 0.2rem rgba(184, 224, 210, 0.25);
        }
        
        .dark-mode .form-control:focus, .dark-mode .form-select:focus {
            border-color: #3a6d5d;
            box-shadow: 0 0 0 0.2rem rgba(42, 77, 63, 0.25);
        }
        
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--mint) 0%, var(--blush) 100%);
            transition: all 0.3s ease;
        }
        
        .dark-mode .login-container {
            background: linear-gradient(135deg, #2a4d3f 0%, #5d3a3a 100%);
        }
        
        .login-card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            transition: all 0.3s ease;
        }
        
        .dark-mode .login-card {
            background-color: var(--dark-card);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .page-transition {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .badge-low-stock {
            background-color: var(--danger);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .modal-content {
            border-radius: 12px;
            border: none;
            background-color: white;
        }
        
        .dark-mode .modal-content {
            background-color: var(--dark-card);
            color: var(--dark-text);
        }
        
        .modal-header {
            background-color: var(--soft-gray);
            border-radius: 12px 12px 0 0;
        }
        
        .dark-mode .modal-header {
            background-color: #2a2a2a;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .currency::before {
            content: "₱";
        }
        
        .delete-all-section {
            background-color: #fff5f5;
            border: 1px solid #ffcccc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .dark-mode .delete-all-section {
            background-color: #3a2a2a;
            border: 1px solid #5d3a3a;
        }
        
        .dark-mode .alert-warning {
            background-color: #3a3a2a;
            border-color: #5d5d3a;
            color: var(--dark-text);
        }
        
        .dark-mode .list-group-item {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        footer {
            background-color: white;
            padding: 20px 0;
            border-top: 1px solid var(--soft-gray);
            transition: all 0.3s ease;
            margin-top: auto;
            width: 100%;
        }
        
        .dark-mode footer {
            background-color: var(--dark-card);
            border-top: 1px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        .dark-mode .dropdown-menu {
            background-color: var(--dark-card);
            border: 1px solid var(--dark-border);
        }
        
        .dark-mode .dropdown-item {
            color: var(--dark-text);
        }
        
        .dark-mode .dropdown-item:hover {
            background-color: #2a4d3f;
        }
        
        .dark-mode .input-group-text {
            background-color: #2a2a2a;
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }
        
        /* Main content area */
        .main-content {
            flex: 1;
            padding-bottom: 20px;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sidebar {
                margin-bottom: 20px;
                height: auto;
                position: static;
            }
        }
        
        .theme-toggle {
            cursor: pointer;
            font-size: 1.2rem;
            margin-right: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .dark-mode .empty-state {
            color: #a0a0a0;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Fixed footer */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .main-content {
            flex: 1 0 auto;
        }
        
        footer {
            flex-shrink: 0;
        }

        /* Improved sale modal styles */
        .sale-item-row {
            transition: all 0.3s ease;
        }
        
        .sale-item-row:hover {
            background-color: rgba(184, 224, 210, 0.1);
        }
        
        .sale-summary-card {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        
        .dark-mode .sale-summary-card {
            background-color: #2a2a2a;
        }
        
        /* Settings modal styles */
        .settings-modal .modal-dialog {
            max-width: 800px;
        }
        
        /* Edit modal styles */
        .edit-modal .modal-dialog {
            max-width: 600px;
        }

        /* Product materials section styles */
        .product-materials-section {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .dark-mode .product-materials-section {
            background-color: #2a2a2a;
        }

        /* Improved layout for sale items table */
        .sale-items-table th {
            background-color: var(--mint);
            color: #333;
        }
        
        .dark-mode .sale-items-table th {
            background-color: #2a4d3f;
            color: var(--dark-text);
        }
        
        .sale-items-table .form-control {
            padding: 8px 12px;
        }
        
        /* Improved layout for product materials table */
        .product-materials-table th {
            background-color: var(--mint);
            color: #333;
        }
        
        .dark-mode .product-materials-table th {
            background-color: #2a4d3f;
            color: var(--dark-text);
        }
        
        .product-materials-table .form-control {
            padding: 8px 12px;
        }
        
        /* Improved layout for material form */
        .material-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .material-form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="korean-theme">
    <!-- Toast Container (moved outside of main app for accessibility) -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-info-circle text-primary me-2"></i>
                <strong class="me-auto">System Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Welcome to NoodleCost!
            </div>
        </div>
    </div>

    <!-- Login Screen (initially shown) -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="text-center mb-4">
                <h2 class="fw-bold">NoodleCost</h2>
                <p class="text-muted">Costing Management of Sales</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" placeholder="Enter username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter password" required>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="rememberMe">
                    <label class="form-check-label" for="rememberMe">Remember me</label>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-2">Login</button>
                <div class="text-center mt-3">
                    <a href="#" id="showRegister">Don't have an account? Register</a>
                </div>
            </form>
            
            <form id="registerForm" class="d-none">
                <div class="mb-3">
                    <label for="regUsername" class="form-label">Username</label>
                    <input type="text" class="form-control" id="regUsername" placeholder="Enter username" required>
                </div>
                <div class="mb-3">
                    <label for="regEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="regEmail" placeholder="Enter email" required>
                </div>
                <div class="mb-3">
                    <label for="regPassword" class="form-label">Password</label>
                    <input type="password" class="form-control" id="regPassword" placeholder="Enter password" required>
                </div>
                <div class="mb-3">
                    <label for="regConfirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="regConfirmPassword" placeholder="Confirm password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-2">Register</button>
                <div class="text-center mt-3">
                    <a href="#" id="showLogin">Already have an account? Login</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Application (initially hidden) -->
    <div id="mainApp" class="d-none d-flex flex-column min-vh-100">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="bi bi-graph-up"></i> NoodleCost
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <span class="nav-link theme-toggle" id="themeToggle">
                                <i class="bi bi-moon"></i>
                            </span>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle"></i> <span id="currentUsername">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal"><i class="bi bi-gear"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <div class="container-fluid mt-4">
                <div class="row">
                    <!-- Sidebar Navigation -->
                    <div class="col-lg-2">
                        <div class="sidebar">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#" data-page="dashboard">
                                        <i class="bi bi-speedometer2"></i> Dashboard
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="sales">
                                        <i class="bi bi-cart-check"></i> Sales
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="inventory">
                                        <i class="bi bi-box-seam"></i> Inventory
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="materials">
                                        <i class="bi bi-tools"></i> Materials
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="reports">
                                        <i class="bi bi-bar-chart"></i> Reports
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- Page Content -->
                    <div class="col-lg-10">
                        <div id="pageContent" class="page-transition">
                            <!-- Dashboard Page -->
                            <div id="dashboardPage" class="page">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Dashboard</h3>
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary active" data-period="today">Today</button>
                                        <button class="btn btn-outline-secondary" data-period="week">Week</button>
                                        <button class="btn btn-outline-secondary" data-period="month">Month</button>
                                        <button class="btn btn-outline-secondary" data-period="year">Year</button>
                                    </div>
                                </div>

                                <!-- KPI Cards -->
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="card kpi-card">
                                            <div class="kpi-value revenue currency">0</div>
                                            <div class="kpi-label">Total Revenue</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card kpi-card">
                                            <div class="kpi-value cost currency">0</div>
                                            <div class="kpi-label">Total Cost</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card kpi-card">
                                            <div class="kpi-value profit currency">0</div>
                                            <div class="kpi-label">Gross Profit</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card kpi-card">
                                            <div class="kpi-value sales">0</div>
                                            <div class="kpi-label">Total Sales</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Charts and Data -->
                                <div class="row mt-4">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">Sales Trend</div>
                                            <div class="card-body">
                                                <div class="chart-container">
                                                    <canvas id="salesChart"></canvas>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">Top Selling Items</div>
                                            <div class="card-body">
                                                <div id="topSellingItems" class="empty-state">
                                                    <i class="bi bi-graph-up"></i>
                                                    <p>No sales data available</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="card mt-4">
                                            <div class="card-header">Low Stock Alerts</div>
                                            <div class="card-body" id="lowStockAlerts">
                                                <div class="empty-state">
                                                    <i class="bi bi-check-circle"></i>
                                                    <p>No low stock alerts</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sales Page -->
                            <div id="salesPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Sales Management</h3>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSaleModal">
                                        <i class="bi bi-plus-circle"></i> New Sale
                                    </button>
                                </div>

                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>Recent Sales</span>
                                        <div class="input-group" style="width: 300px;">
                                            <input type="text" class="form-control" id="salesSearch" placeholder="Search sales...">
                                            <button class="btn btn-outline-secondary" type="button" id="salesSearchBtn">
                                                <i class="bi bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Date</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="salesTableBody">
                                                    <tr>
                                                        <td colspan="3" class="text-center text-muted py-4">No sales records found</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Delete All Sales Section -->
                                <div class="delete-all-section">
                                    <h5 class="text-danger"><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
                                    <p class="mb-3">Permanently delete all sales records. This action cannot be undone.</p>
                                    <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAllSalesModal">
                                        <i class="bi bi-trash"></i> Delete All Sales
                                    </button>
                                </div>
                            </div>

                            <!-- Inventory Page -->
                            <div id="inventoryPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Inventory Management</h3>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                                        <i class="bi bi-plus-circle"></i> Add Product
                                    </button>
                                </div>

                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>Product List</span>
                                        <div class="input-group" style="width: 300px;">
                                            <input type="text" class="form-control" id="productsSearch" placeholder="Search products...">
                                            <button class="btn btn-outline-secondary" type="button" id="productsSearchBtn">
                                                <i class="bi bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Name of Product</th>
                                                        <th>Stock</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="productsTableBody">
                                                    <tr>
                                                        <td colspan="4" class="text-center text-muted py-4">No products found</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Delete All Products Section -->
                                <div class="delete-all-section">
                                    <h5 class="text-danger"><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
                                    <p class="mb-3">Permanently delete all products and inventory records. This action cannot be undone.</p>
                                    <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAllProductsModal">
                                        <i class="bi bi-trash"></i> Delete All Products
                                    </button>
                                </div>
                            </div>

                            <!-- Materials Page -->
                            <div id="materialsPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Materials Management</h3>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMaterialModal">
                                        <i class="bi bi-plus-circle"></i> Add Material
                                    </button>
                                </div>

                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>Material List</span>
                                        <div class="input-group" style="width: 300px;">
                                            <input type="text" class="form-control" id="materialsSearch" placeholder="Search materials...">
                                            <button class="btn btn-outline-secondary" type="button" id="materialsSearchBtn">
                                                <i class="bi bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Name of Product</th>
                                                        <th>Stock</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="materialsTableBody">
                                                    <tr>
                                                        <td colspan="4" class="text-center text-muted py-4">No materials found</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Delete All Materials Section -->
                                <div class="delete-all-section">
                                    <h5 class="text-danger"><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
                                    <p class="mb-3">Permanently delete all materials records. This action cannot be undone.</p>
                                    <button class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteAllMaterialsModal">
                                        <i class="bi bi-trash"></i> Delete All Materials
                                    </button>
                                </div>
                            </div>

                            <!-- Reports Page -->
                            <div id="reportsPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Reports & Analytics</h3>
                                    <div>
                                        <button class="btn btn-outline-primary" id="exportCsvBtn">
                                            <i class="bi bi-download"></i> Export CSV
                                        </button>
                                        <button class="btn btn-outline-primary" id="exportPdfBtn">
                                            <i class="bi bi-file-pdf"></i> Export PDF
                                        </button>
                                    </div>
                                </div>

                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <label for="reportType" class="form-label">Report Type</label>
                                        <select class="form-select" id="reportType">
                                            <option value="sales" selected>Sales Report</option>
                                            <option value="inventory">Inventory Report</option>
                                            <option value="profit">Profit Report</option>
                                            <option value="materials">Materials Report</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="dateFrom" class="form-label">From Date</label>
                                        <input type="date" class="form-control" id="dateFrom">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="dateTo" class="form-label">To Date</label>
                                        <input type="date" class="form-control" id="dateTo">
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="generateReportBtn">Generate Report</button>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header" id="reportTitle">Sales Report</div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="reportChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-header">Report Summary</div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <h5>Total Sales</h5>
                                                <p class="fs-4 text-success currency">0</p>
                                            </div>
                                            <div class="col-md-4">
                                                <h5>Total Cost</h5>
                                                <p class="fs-4 text-danger currency">0</p>
                                            </div>
                                            <div class="col-md-4">
                                                <h5>Gross Profit</h5>
                                                <p class="fs-4 text-info currency">0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <p class="mb-0">&copy; 2025 NoodleCost. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <!-- Add Sale Modal -->
    <div class="modal fade" id="addSaleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">New Sale</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="saleForm">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="saleDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="saleDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="customer" class="form-label">Customer (Optional)</label>
                                <input type="text" class="form-control" id="customer" placeholder="Customer name">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <label class="form-label mb-0">Sale Items</label>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addItem">
                                    <i class="bi bi-plus-circle"></i> Add Item
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered sale-items-table">
                                    <thead>
                                        <tr>
                                            <th>Product Name</th>
                                            <th>Quantity</th>
                                            <th>Price</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="saleItems">
                                        <tr class="sale-item-row">
                                            <td>
                                                <select class="form-select product-select">
                                                    <option selected>Select Product</option>
                                                </select>
                                            </td>
                                            <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                                            <td>
                                                <div class="input-group">
                                                    <span class="input-group-text">₱</span>
                                                    <input type="number" class="form-control unit-price" value="0.00" step="0.01">
                                                </div>
                                            </td>
                                            <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSaleBtn">Save Sale</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Sale Modal -->
    <div class="modal fade edit-modal" id="editSaleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Sale</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editSaleForm">
                        <input type="hidden" id="editSaleId">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="editSaleDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="editSaleDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="editCustomer" class="form-label">Customer (Optional)</label>
                                <input type="text" class="form-control" id="editCustomer" placeholder="Customer name">
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <label class="form-label mb-0">Sale Items</label>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="editAddItem">
                                    <i class="bi bi-plus-circle"></i> Add Item
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered sale-items-table">
                                    <thead>
                                        <tr>
                                            <th>Product Name</th>
                                            <th>Quantity</th>
                                            <th>Price</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="editSaleItems">
                                        <!-- Items will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateSaleBtn">Update Sale</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="productName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="productStock" class="form-label">Stock Quantity</label>
                                <input type="number" class="form-control" id="productStock" required>
                            </div>
                        </div>
                        
                        <!-- Product Materials Section -->
                        <div class="product-materials-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <label class="form-label mb-0">Product Materials</label>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addProductMaterial">
                                    <i class="bi bi-plus-circle"></i> Add Material
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered product-materials-table">
                                    <thead>
                                        <tr>
                                            <th>Material Name</th>
                                            <th>Quantity</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productMaterials">
                                        <tr class="product-material-row">
                                            <td>
                                                <select class="form-select material-select">
                                                    <option selected>Select Material</option>
                                                </select>
                                            </td>
                                            <td><input type="number" class="form-control material-quantity" value="1" min="1"></td>
                                            <td><button type="button" class="btn btn-sm btn-danger remove-product-material"><i class="bi bi-trash"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveProductBtn">Save Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div class="modal fade edit-modal" id="editProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm">
                        <input type="hidden" id="editProductId">
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="editProductName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="editProductName" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="editProductStock" class="form-label">Stock Quantity</label>
                                <input type="number" class="form-control" id="editProductStock" required>
                            </div>
                        </div>
                        
                        <!-- Edit Product Materials Section -->
                        <div class="product-materials-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <label class="form-label mb-0">Product Materials</label>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="editAddProductMaterial">
                                    <i class="bi bi-plus-circle"></i> Add Material
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered product-materials-table">
                                    <thead>
                                        <tr>
                                            <th>Material Name</th>
                                            <th>Quantity</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="editProductMaterials">
                                        <!-- Materials will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateProductBtn">Update Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Material Modal -->
    <div class="modal fade" id="addMaterialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="materialForm">
                        <div class="mb-3">
                            <label for="materialName" class="form-label">Material Name</label>
                            <input type="text" class="form-control" id="materialName" required>
                        </div>
                        <div class="mb-3">
                            <label for="materialCategory" class="form-label">Category</label>
                            <input type="text" class="form-control" id="materialCategory" required>
                        </div>
                        <div class="mb-3">
                            <label for="materialUnit" class="form-label">Unit</label>
                            <input type="text" class="form-control" id="materialUnit" required>
                        </div>
                        <div class="mb-3">
                            <label for="materialStock" class="form-label">Stock Quantity</label>
                            <input type="number" class="form-control" id="materialStock" required>
                        </div>
                        <div class="mb-3">
                            <label for="materialDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="materialDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMaterialBtn">Save Material</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Material Modal -->
    <div class="modal fade edit-modal" id="editMaterialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Material</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editMaterialForm">
                        <input type="hidden" id="editMaterialId">
                        <div class="mb-3">
                            <label for="editMaterialName" class="form-label">Material Name</label>
                            <input type="text" class="form-control" id="editMaterialName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMaterialCategory" class="form-label">Category</label>
                            <input type="text" class="form-control" id="editMaterialCategory" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMaterialUnit" class="form-label">Unit</label>
                            <input type="text" class="form-control" id="editMaterialUnit" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMaterialStock" class="form-label">Stock Quantity</label>
                            <input type="number" class="form-control" id="editMaterialStock" required>
                        </div>
                        <div class="mb-3">
                            <label for="editMaterialDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editMaterialDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateMaterialBtn">Update Material</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade settings-modal" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">System Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Application Settings</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="companyName" class="form-label">Company Name</label>
                                        <input type="text" class="form-control" id="companyName" value="NoodleCost">
                                    </div>
                                    <div class="mb-3">
                                        <label for="currency" class="form-label">Currency</label>
                                        <select class="form-select" id="currency">
                                            <option value="peso" selected>Philippine Peso (₱)</option>
                                            <option value="usd">US Dollar ($)</option>
                                            <option value="euro">Euro (€)</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taxRate" class="form-label">Tax Rate (%)</label>
                                        <input type="number" class="form-control" id="taxRate" value="12" step="0.1">
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="lowStockAlert" checked>
                                        <label class="form-check-label" for="lowStockAlert">Enable low stock alerts</label>
                                    </div>
                                    <div class="mb-3">
                                        <label for="lowStockThreshold" class="form-label">Low Stock Threshold</label>
                                        <input type="number" class="form-control" id="lowStockThreshold" value="10">
                                    </div>
                                    <div class="mb-3">
                                        <label for="priceMarkup" class="form-label">Price Markup Percentage</label>
                                        <input type="number" class="form-control" id="priceMarkup" value="30" step="0.1">
                                    </div>
                                    <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Admin Account</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="adminUsername" class="form-label">Username</label>
                                        <input type="text" class="form-control" id="adminUsername">
                                    </div>
                                    <div class="mb-3">
                                        <label for="adminEmail" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="adminEmail">
                                    </div>
                                    <div class="mb-3">
                                        <label for="currentPassword" class="form-label">Current Password</label>
                                        <input type="password" class="form-control" id="currentPassword">
                                    </div>
                                    <div class="mb-3">
                                        <label for="newPassword" class="form-label">New Password</label>
                                        <input type="password" class="form-control" id="newPassword">
                                    </div>
                                    <div class="mb-3">
                                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                        <input type="password" class="form-control" id="confirmPassword">
                                    </div>
                                    <button class="btn btn-primary" id="updateAccountBtn">Update Account</button>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">Data Management</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <button class="btn btn-outline-primary w-100 mb-2" id="downloadDataBtn">
                                            <i class="bi bi-download"></i> Download All Data
                                        </button>
                                        <button class="btn btn-outline-secondary w-100 mb-2" id="uploadDataBtn">
                                            <i class="bi bi-upload"></i> Upload Data
                                        </button>
                                        <input type="file" id="uploadDataInput" class="d-none" accept=".json">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Delete All Data Section -->
                    <div class="delete-all-section mt-4">
                        <h5 class="text-danger"><i class="bi bi-exclamation-triangle"></i> Danger Zone</h5>
                        <p class="mb-3">Permanently delete ALL data including sales, products, materials, and settings. This action cannot be undone and will reset the application to its initial state.</p>
                        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAllDataModal">
                            <i class="bi bi-trash"></i> Delete All Data
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i class="bi bi-exclamation-triangle"></i> Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteConfirmationMessage">Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete All Sales Modal -->
    <div class="modal fade" id="deleteAllSalesModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i class="bi bi-exclamation-triangle"></i> Delete All Sales</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete ALL sales records? This action cannot be undone.</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDeleteSales">
                        <label class="form-check-label" for="confirmDeleteSales">
                            I understand this will permanently delete all sales data
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteSalesBtn" disabled>Delete All Sales</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete All Products Modal -->
    <div class="modal fade" id="deleteAllProductsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i class="bi bi-exclamation-triangle"></i> Delete All Products</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete ALL products and inventory records? This action cannot be undone.</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDeleteProducts">
                        <label class="form-check-label" for="confirmDeleteProducts">
                            I understand this will permanently delete all product data
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteProductsBtn" disabled>Delete All Products</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete All Materials Modal -->
    <div class="modal fade" id="deleteAllMaterialsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i class="bi bi-exclamation-triangle"></i> Delete All Materials</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete ALL materials records? This action cannot be undone.</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDeleteMaterials">
                        <label class="form-check-label" for="confirmDeleteMaterials">
                            I understand this will permanently delete all materials data
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteMaterialsBtn" disabled>Delete All Materials</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete All Data Modal -->
    <div class="modal fade" id="deleteAllDataModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i class="bi bi-exclamation-triangle"></i> Delete All Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="fw-bold">WARNING: This action will permanently delete ALL data in the system including:</p>
                    <ul>
                        <li>All sales records</li>
                        <li>All product and inventory data</li>
                        <li>All materials information</li>
                        <li>All system settings</li>
                    </ul>
                    <p>This action cannot be undone and will reset the application to its initial state.</p>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDeleteAll">
                        <label class="form-check-label" for="confirmDeleteAll">
                            I understand this will permanently delete ALL data and reset the system
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="deleteAllBtn" disabled>Delete All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Application state
        const appState = {
            currentPage: 'dashboard',
            isLoggedIn: false,
            currency: 'peso',
            currencySymbol: '₱',
            darkMode: false,
            users: [],
            currentUser: null,
            sales: [],
            products: [],
            materials: [],
            settings: {
                companyName: 'NoodleCost',
                currency: 'peso',
                taxRate: 12,
                lowStockAlert: true,
                lowStockThreshold: 10,
                priceMarkup: 30
            },
            // Add properties for edit functionality
            editingSale: null,
            editingProduct: null,
            editingMaterial: null,
            deleteTarget: { type: null, id: null }
        };

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegister = document.getElementById('showRegister');
        const showLogin = document.getElementById('showLogin');
        const logoutBtn = document.getElementById('logoutBtn');
        const sidebarLinks = document.querySelectorAll('.sidebar .nav-link');
        const pages = document.querySelectorAll('.page');
        const toastEl = document.getElementById('liveToast');
        const toastMessage = document.getElementById('toastMessage');
        const toast = new bootstrap.Toast(toastEl);
        const themeToggle = document.getElementById('themeToggle');
        const currentUsername = document.getElementById('currentUsername');
        
        // Initialize charts
        let salesChart, reportChart;

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize data and UI
            initializeApp();
            
            // Set current date for forms
            document.getElementById('saleDate').valueAsDate = new Date();
            document.getElementById('dateFrom').valueAsDate = new Date();
            document.getElementById('dateTo').valueAsDate = new Date();
            
            // Login form submission
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (username && password) {
                    login(username, password);
                } else {
                    showToast('Please enter both username and password', 'warning');
                }
            });
            
            // Register form submission
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('regUsername').value;
                const email = document.getElementById('regEmail').value;
                const password = document.getElementById('regPassword').value;
                const confirmPassword = document.getElementById('regConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'warning');
                    return;
                }
                
                register(username, email, password);
            });
            
            // Show register form
            showRegister.addEventListener('click', function(e) {
                e.preventDefault();
                showRegisterForm();
            });
            
            // Show login form
            showLogin.addEventListener('click', function(e) {
                e.preventDefault();
                showLoginForm();
            });
            
            // Logout
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // Sidebar navigation
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    navigateToPage(page);
                });
            });
            
            // Dashboard period buttons
            document.querySelectorAll('[data-period]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-period]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDashboardData(this.getAttribute('data-period'));
                });
            });
            
            // Sale item management
            document.getElementById('addItem').addEventListener('click', addSaleItem);
            document.getElementById('editAddItem').addEventListener('click', addEditSaleItem);
            
            // Product material management
            document.getElementById('addProductMaterial').addEventListener('click', addProductMaterial);
            document.getElementById('editAddProductMaterial').addEventListener('click', addEditProductMaterial);
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-item')) {
                    e.target.closest('tr').remove();
                    calculateSaleTotals();
                }
                
                if (e.target.classList.contains('remove-product-material')) {
                    e.target.closest('tr').remove();
                    calculateProductCost();
                }
                
                if (e.target.classList.contains('quantity') || 
                    e.target.classList.contains('unit-price')) {
                    calculateItemTotal(e.target.closest('tr'));
                }
                
                if (e.target.classList.contains('material-quantity') && e.target.closest('#productMaterials')) {
                    calculateProductMaterialTotal(e.target.closest('tr'));
                }
                
                // Product select change
                if (e.target.classList.contains('product-select')) {
                    const productId = e.target.value;
                    const product = appState.products.find(p => p.id === productId);
                    if (product) {
                        const row = e.target.closest('tr');
                        row.querySelector('.unit-price').value = product.price.toFixed(2);
                        calculateItemTotal(row);
                    }
                }
            });
            
            // Delete confirmation checkboxes
            document.getElementById('confirmDeleteSales').addEventListener('change', function() {
                document.getElementById('deleteSalesBtn').disabled = !this.checked;
            });
            
            document.getElementById('confirmDeleteProducts').addEventListener('change', function() {
                document.getElementById('deleteProductsBtn').disabled = !this.checked;
            });
            
            document.getElementById('confirmDeleteMaterials').addEventListener('change', function() {
                document.getElementById('deleteMaterialsBtn').disabled = !this.checked;
            });
            
            document.getElementById('confirmDeleteAll').addEventListener('change', function() {
                document.getElementById('deleteAllBtn').disabled = !this.checked;
            });
            
            // Delete actions
            document.getElementById('deleteSalesBtn').addEventListener('click', function() {
                deleteAllSales();
                bootstrap.Modal.getInstance(document.getElementById('deleteAllSalesModal')).hide();
            });
            
            document.getElementById('deleteProductsBtn').addEventListener('click', function() {
                deleteAllProducts();
                bootstrap.Modal.getInstance(document.getElementById('deleteAllProductsModal')).hide();
            });
            
            document.getElementById('deleteMaterialsBtn').addEventListener('click', function() {
                deleteAllMaterials();
                bootstrap.Modal.getInstance(document.getElementById('deleteAllMaterialsModal')).hide();
            });
            
            document.getElementById('deleteAllBtn').addEventListener('click', function() {
                deleteAllData();
                bootstrap.Modal.getInstance(document.getElementById('deleteAllDataModal')).hide();
            });
            
            // Save buttons
            document.getElementById('saveSaleBtn').addEventListener('click', saveSale);
            document.getElementById('saveProductBtn').addEventListener('click', saveProduct);
            document.getElementById('saveMaterialBtn').addEventListener('click', saveMaterial);
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('updateAccountBtn').addEventListener('click', updateAccount);
            
            // Update buttons
            document.getElementById('updateSaleBtn').addEventListener('click', updateSale);
            document.getElementById('updateProductBtn').addEventListener('click', updateProduct);
            document.getElementById('updateMaterialBtn').addEventListener('click', updateMaterial);
            
            // Report buttons
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCsv);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPdf);
            
            // Search buttons
            document.getElementById('salesSearchBtn').addEventListener('click', searchSales);
            document.getElementById('productsSearchBtn').addEventListener('click', searchProducts);
            document.getElementById('materialsSearchBtn').addEventListener('click', searchMaterials);
            
            // Data management buttons
            document.getElementById('downloadDataBtn').addEventListener('click', downloadAllData);
            document.getElementById('uploadDataBtn').addEventListener('click', function() {
                document.getElementById('uploadDataInput').click();
            });
            document.getElementById('uploadDataInput').addEventListener('change', uploadData);
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleDarkMode);
            
            // Delete confirmation
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);
        });
        
        // Functions
        function initializeApp() {
            // Load data from localStorage
            loadDataFromStorage();
            
            // Check if user is logged in
            if (appState.currentUser) {
                showMainApp();
            } else {
                showLoginScreen();
            }
            
            // Apply theme
            applyTheme();
            
            // Initialize charts
            initCharts();
            
            // Update UI with current data
            updateDashboardData('today');
            updateSalesTable();
            updateProductsTable();
            updateMaterialsTable();
            populateProductSelects();
            populateMaterialSelects();
            loadSettingsForm();
            loadAccountForm();
        }
        
        function loadDataFromStorage() {
            // Load users
            const storedUsers = localStorage.getItem('noodleCost_users');
            if (storedUsers) {
                appState.users = JSON.parse(storedUsers);
            } else {
                // Create default admin user
                appState.users = [
                    { username: 'admin', email: 'admin@noodecost.com', password: 'admin123' }
                ];
                saveUsersToStorage();
            }
            
            // Load current user
            const storedCurrentUser = localStorage.getItem('noodleCost_currentUser');
            if (storedCurrentUser) {
                appState.currentUser = JSON.parse(storedCurrentUser);
                currentUsername.textContent = appState.currentUser.username;
            }
            
            // Load sales
            const storedSales = localStorage.getItem('noodleCost_sales');
            if (storedSales) {
                appState.sales = JSON.parse(storedSales);
            }
            
            // Load products
            const storedProducts = localStorage.getItem('noodleCost_products');
            if (storedProducts) {
                appState.products = JSON.parse(storedProducts);
            }
            
            // Load materials
            const storedMaterials = localStorage.getItem('noodleCost_materials');
            if (storedMaterials) {
                appState.materials = JSON.parse(storedMaterials);
            }
            
            // Load settings
            const storedSettings = localStorage.getItem('noodleCost_settings');
            if (storedSettings) {
                appState.settings = JSON.parse(storedSettings);
            }
            
            // Load theme
            const storedTheme = localStorage.getItem('noodleCost_darkMode');
            if (storedTheme) {
                appState.darkMode = JSON.parse(storedTheme);
            }
        }
        
        function saveUsersToStorage() {
            localStorage.setItem('noodleCost_users', JSON.stringify(appState.users));
        }
        
        function saveCurrentUserToStorage() {
            localStorage.setItem('noodleCost_currentUser', JSON.stringify(appState.currentUser));
        }
        
        function saveSalesToStorage() {
            localStorage.setItem('noodleCost_sales', JSON.stringify(appState.sales));
        }
        
        function saveProductsToStorage() {
            localStorage.setItem('noodleCost_products', JSON.stringify(appState.products));
        }
        
        function saveMaterialsToStorage() {
            localStorage.setItem('noodleCost_materials', JSON.stringify(appState.materials));
        }
        
        function saveSettingsToStorage() {
            localStorage.setItem('noodleCost_settings', JSON.stringify(appState.settings));
        }
        
        function saveThemeToStorage() {
            localStorage.setItem('noodleCost_darkMode', JSON.stringify(appState.darkMode));
        }
        
        function initCharts() {
            // Sales Trend Chart
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Sales',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: '#95d5b2',
                        backgroundColor: 'rgba(149, 213, 178, 0.1)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Cost',
                        data: [0, 0, 0, 0, 0, 0],
                        borderColor: '#ff9b85',
                        backgroundColor: 'rgba(255, 155, 133, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${appState.currencySymbol}${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return `${appState.currencySymbol}${value.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Report Chart
            const reportCtx = document.getElementById('reportChart').getContext('2d');
            reportChart = new Chart(reportCtx, {
                type: 'bar',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Revenue',
                        data: [0, 0, 0, 0],
                        backgroundColor: '#b8e0d2'
                    }, {
                        label: 'Cost',
                        data: [0, 0, 0, 0],
                        backgroundColor: '#ff9b85'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${appState.currencySymbol}${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return `${appState.currencySymbol}${value.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function login(username, password) {
            const user = appState.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                appState.currentUser = user;
                saveCurrentUserToStorage();
                currentUsername.textContent = user.username;
                showMainApp();
                showToast('Login successful! Welcome to NoodleCost.', 'success');
            } else {
                showToast('Invalid username or password', 'danger');
            }
        }
        
        function register(username, email, password) {
            // Check if username already exists
            if (appState.users.find(u => u.username === username)) {
                showToast('Username already exists', 'warning');
                return;
            }
            
            // Create new user
            const newUser = { username, email, password };
            appState.users.push(newUser);
            saveUsersToStorage();
            
            showToast('Registration successful! Please login.', 'success');
            showLoginForm();
        }
        
        function logout() {
            appState.currentUser = null;
            localStorage.removeItem('noodleCost_currentUser');
            showLoginScreen();
            showToast('You have been logged out.', 'info');
        }
        
        function showLoginScreen() {
            loginScreen.classList.remove('d-none');
            mainApp.classList.add('d-none');
            showLoginForm();
        }
        
        function showMainApp() {
            loginScreen.classList.add('d-none');
            mainApp.classList.remove('d-none');
        }
        
        function showLoginForm() {
            loginForm.classList.remove('d-none');
            registerForm.classList.add('d-none');
        }
        
        function showRegisterForm() {
            loginForm.classList.add('d-none');
            registerForm.classList.remove('d-none');
        }
        
        function navigateToPage(page) {
            // Update active link in sidebar
            sidebarLinks.forEach(link => {
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Show the selected page
            pages.forEach(p => {
                if (p.id === `${page}Page`) {
                    p.classList.remove('d-none');
                    p.classList.add('page-transition');
                } else {
                    p.classList.add('d-none');
                }
            });
            
            appState.currentPage = page;
        }
        
        function updateDashboardData(period) {
            // Calculate totals based on period
            let totalRevenue = 0;
            let totalCost = 0;
            let totalProfit = 0;
            let totalSales = 0;
            
            // In a real app, this would filter by date period
            appState.sales.forEach(sale => {
                totalRevenue += sale.total;
                totalCost += sale.cost;
                totalProfit += sale.profit;
                totalSales += 1;
            });
            
            // Update KPI cards
            document.querySelector('.revenue.currency').textContent = totalRevenue.toLocaleString();
            document.querySelector('.cost.currency').textContent = totalCost.toLocaleString();
            document.querySelector('.profit.currency').textContent = totalProfit.toLocaleString();
            document.querySelector('.sales').textContent = totalSales;
            
            // Update top selling items
            updateTopSellingItems();
            
            // Update low stock alerts
            updateLowStockAlerts();
            
            // Update chart data
            updateChartData();
        }
        
        function updateTopSellingItems() {
            const topSellingContainer = document.getElementById('topSellingItems');
            
            if (appState.sales.length === 0) {
                topSellingContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-graph-up"></i>
                        <p>No sales data available</p>
                    </div>
                `;
                return;
            }
            
            // Calculate top selling items
            const itemCounts = {};
            appState.sales.forEach(sale => {
                sale.items.forEach(item => {
                    if (itemCounts[item.productName]) {
                        itemCounts[item.productName] += item.quantity;
                    } else {
                        itemCounts[item.productName] = item.quantity;
                    }
                });
            });
            
            // Sort by quantity sold
            const sortedItems = Object.entries(itemCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            if (sortedItems.length === 0) {
                topSellingContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-graph-up"></i>
                        <p>No top selling items data</p>
                    </div>
                `;
                return;
            }
            
            let itemsHTML = '';
            sortedItems.forEach(([name, quantity]) => {
                itemsHTML += `
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>${name}</span>
                        <span class="badge bg-primary">${quantity}</span>
                    </div>
                `;
            });
            
            topSellingContainer.innerHTML = itemsHTML;
        }
        
        function updateLowStockAlerts() {
            const lowStockContainer = document.getElementById('lowStockAlerts');
            const lowStockProducts = appState.products.filter(p => p.stock <= appState.settings.lowStockThreshold);
            const lowStockMaterials = appState.materials.filter(m => m.stock <= appState.settings.lowStockThreshold);
            
            if (lowStockProducts.length === 0 && lowStockMaterials.length === 0) {
                lowStockContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-check-circle"></i>
                        <p>No low stock alerts</p>
                    </div>
                `;
                return;
            }
            
            let alertsHTML = '';
            lowStockProducts.forEach(product => {
                alertsHTML += `
                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <div>${product.name} is running low (${product.stock} remaining)</div>
                    </div>
                `;
            });
            
            lowStockMaterials.forEach(material => {
                alertsHTML += `
                    <div class="alert alert-warning d-flex align-items-center" role="alert">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <div>${material.name} is running low (${material.stock} remaining)</div>
                    </div>
                `;
            });
            
            lowStockContainer.innerHTML = alertsHTML;
        }
        
        function updateChartData() {
            // Update sales chart with actual data
            const monthlyData = calculateMonthlyData();
            
            salesChart.data.datasets[0].data = monthlyData.revenue;
            salesChart.data.datasets[1].data = monthlyData.cost;
            salesChart.update();
            
            // Update report chart
            const weeklyData = calculateWeeklyData();
            reportChart.data.datasets[0].data = weeklyData.revenue;
            reportChart.data.datasets[1].data = weeklyData.cost;
            reportChart.update();
        }
        
        function calculateMonthlyData() {
            const revenue = [0, 0, 0, 0, 0, 0];
            const cost = [0, 0, 0, 0, 0, 0];
            
            appState.sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const month = saleDate.getMonth();
                if (month >= 0 && month <= 5) { // Jan to Jun
                    revenue[month] += sale.total;
                    cost[month] += sale.cost;
                }
            });
            
            return { revenue, cost };
        }
        
        function calculateWeeklyData() {
            const revenue = [0, 0, 0, 0];
            const cost = [0, 0, 0, 0];
            
            appState.sales.forEach(sale => {
                const saleDate = new Date(sale.date);
                const dayOfMonth = saleDate.getDate();
                let week = 0;
                
                if (dayOfMonth <= 7) week = 0;
                else if (dayOfMonth <= 14) week = 1;
                else if (dayOfMonth <= 21) week = 2;
                else week = 3;
                
                revenue[week] += sale.total;
                cost[week] += sale.cost;
            });
            
            return { revenue, cost };
        }
        
        function updateSalesTable() {
            const salesTableBody = document.getElementById('salesTableBody');
            
            if (appState.sales.length === 0) {
                salesTableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center text-muted py-4">No sales records found</td>
                    </tr>
                `;
                return;
            }
            
            let salesHTML = '';
            appState.sales.forEach(sale => {
                salesHTML += `
                    <tr>
                        <td>${sale.id}</td>
                        <td>${sale.date}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-sale" data-id="${sale.id}">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary edit-sale" data-id="${sale.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-sale" data-id="${sale.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            salesTableBody.innerHTML = salesHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-sale').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = this.getAttribute('data-id');
                    viewSale(saleId);
                });
            });
            
            document.querySelectorAll('.edit-sale').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = this.getAttribute('data-id');
                    editSale(saleId);
                });
            });
            
            document.querySelectorAll('.delete-sale').forEach(btn => {
                btn.addEventListener('click', function() {
                    const saleId = this.getAttribute('data-id');
                    showDeleteConfirmation('sale', saleId, 'Are you sure you want to delete this sale?');
                });
            });
        }
        
        function updateProductsTable() {
            const productsTableBody = document.getElementById('productsTableBody');
            
            if (appState.products.length === 0) {
                productsTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-muted py-4">No products found</td>
                    </tr>
                `;
                return;
            }
            
            let productsHTML = '';
            appState.products.forEach(product => {
                const stockBadge = product.stock <= appState.settings.lowStockThreshold ? 
                    `<span class="badge badge-low-stock">${product.stock}</span>` : 
                    `<span class="badge bg-success">${product.stock}</span>`;
                
                productsHTML += `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${stockBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-product" data-id="${product.id}">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary edit-product" data-id="${product.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-product" data-id="${product.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            productsTableBody.innerHTML = productsHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    viewProduct(productId);
                });
            });
            
            document.querySelectorAll('.edit-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-product').forEach(btn => {
                btn.addEventListener('click', function() {
                    const productId = this.getAttribute('data-id');
                    showDeleteConfirmation('product', productId, 'Are you sure you want to delete this product?');
                });
            });
        }
        
        function updateMaterialsTable() {
            const materialsTableBody = document.getElementById('materialsTableBody');
            
            if (appState.materials.length === 0) {
                materialsTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-muted py-4">No materials found</td>
                    </tr>
                `;
                return;
            }
            
            let materialsHTML = '';
            appState.materials.forEach(material => {
                const stockBadge = material.stock <= appState.settings.lowStockThreshold ? 
                    `<span class="badge badge-low-stock">${material.stock}</span>` : 
                    `<span class="badge bg-success">${material.stock}</span>`;
                
                materialsHTML += `
                    <tr>
                        <td>${material.id}</td>
                        <td>${material.name}</td>
                        <td>${stockBadge}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-material" data-id="${material.id}">
                                <i class="bi bi-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary edit-material" data-id="${material.id}">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger delete-material" data-id="${material.id}">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            materialsTableBody.innerHTML = materialsHTML;
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-material').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    viewMaterial(materialId);
                });
            });
            
            document.querySelectorAll('.edit-material').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    editMaterial(materialId);
                });
            });
            
            document.querySelectorAll('.delete-material').forEach(btn => {
                btn.addEventListener('click', function() {
                    const materialId = this.getAttribute('data-id');
                    showDeleteConfirmation('material', materialId, 'Are you sure you want to delete this material?');
                });
            });
        }
        
        function populateProductSelects() {
            const productSelects = document.querySelectorAll('.product-select');
            
            productSelects.forEach(select => {
                // Clear existing options except the first one
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Add product options
                appState.products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    select.appendChild(option);
                });
            });
        }
        
        function populateMaterialSelects() {
            const materialSelects = document.querySelectorAll('.material-select');
            
            materialSelects.forEach(select => {
                // Clear existing options except the first one
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Add material options
                appState.materials.forEach(material => {
                    const option = document.createElement('option');
                    option.value = material.id;
                    option.textContent = material.name;
                    select.appendChild(option);
                });
            });
        }
        
        function addSaleItem() {
            const saleItems = document.getElementById('saleItems');
            const newRow = document.createElement('tr');
            newRow.className = 'sale-item-row';
            newRow.innerHTML = `
                <td>
                    <select class="form-select product-select">
                        <option selected>Select Product</option>
                    </select>
                </td>
                <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                <td>
                    <div class="input-group">
                        <span class="input-group-text">₱</span>
                        <input type="number" class="form-control unit-price" value="0.00" step="0.01">
                    </div>
                </td>
                <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>
            `;
            saleItems.appendChild(newRow);
            
            // Populate product select for the new row
            populateProductSelects();
            
            // Add event listeners to the new row
            newRow.querySelector('.remove-item').addEventListener('click', function() {
                newRow.remove();
                calculateSaleTotals();
            });
            
            const inputs = newRow.querySelectorAll('.quantity, .unit-price');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    calculateItemTotal(newRow);
                });
            });
            
            newRow.querySelector('.product-select').addEventListener('change', function() {
                const productId = this.value;
                const product = appState.products.find(p => p.id === productId);
                if (product) {
                    newRow.querySelector('.unit-price').value = product.price.toFixed(2);
                    calculateItemTotal(newRow);
                }
            });
        }
        
        function addEditSaleItem() {
            const editSaleItems = document.getElementById('editSaleItems');
            const newRow = document.createElement('tr');
            newRow.className = 'sale-item-row';
            newRow.innerHTML = `
                <td>
                    <select class="form-select product-select">
                        <option selected>Select Product</option>
                    </select>
                </td>
                <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                <td>
                    <div class="input-group">
                        <span class="input-group-text">₱</span>
                        <input type="number" class="form-control unit-price" value="0.00" step="0.01">
                    </div>
                </td>
                <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>
            `;
            editSaleItems.appendChild(newRow);
            
            // Populate product select for the new row
            populateProductSelects();
            
            // Add event listeners to the new row
            newRow.querySelector('.remove-item').addEventListener('click', function() {
                newRow.remove();
                calculateEditSaleTotals();
            });
            
            const inputs = newRow.querySelectorAll('.quantity, .unit-price');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    calculateEditItemTotal(newRow);
                });
            });
            
            newRow.querySelector('.product-select').addEventListener('change', function() {
                const productId = this.value;
                const product = appState.products.find(p => p.id === productId);
                if (product) {
                    newRow.querySelector('.unit-price').value = product.price.toFixed(2);
                    calculateEditItemTotal(newRow);
                }
            });
        }
        
        function addProductMaterial() {
            const productMaterials = document.getElementById('productMaterials');
            const newRow = document.createElement('tr');
            newRow.className = 'product-material-row';
            newRow.innerHTML = `
                <td>
                    <select class="form-select material-select">
                        <option selected>Select Material</option>
                    </select>
                </td>
                <td><input type="number" class="form-control material-quantity" value="1" min="1"></td>
                <td><button type="button" class="btn btn-sm btn-danger remove-product-material"><i class="bi bi-trash"></i></button></td>
            `;
            productMaterials.appendChild(newRow);
            
            // Populate material select for the new row
            populateMaterialSelects();
            
            // Add event listeners to the new row
            newRow.querySelector('.remove-product-material').addEventListener('click', function() {
                newRow.remove();
                calculateProductCost();
            });
            
            newRow.querySelector('.material-quantity').addEventListener('input', function() {
                calculateProductMaterialTotal(newRow);
            });
            
            newRow.querySelector('.material-select').addEventListener('change', function() {
                const materialId = this.value;
                const material = appState.materials.find(m => m.id === materialId);
                if (material) {
                    calculateProductMaterialTotal(newRow);
                }
            });
        }
        
        function addEditProductMaterial() {
            const editProductMaterials = document.getElementById('editProductMaterials');
            const newRow = document.createElement('tr');
            newRow.className = 'product-material-row';
            newRow.innerHTML = `
                <td>
                    <select class="form-select material-select">
                        <option selected>Select Material</option>
                    </select>
                </td>
                <td><input type="number" class="form-control material-quantity" value="1" min="1"></td>
                <td><button type="button" class="btn btn-sm btn-danger remove-product-material"><i class="bi bi-trash"></i></button></td>
            `;
            editProductMaterials.appendChild(newRow);
            
            // Populate material select for the new row
            populateMaterialSelects();
            
            // Add event listeners to the new row
            newRow.querySelector('.remove-product-material').addEventListener('click', function() {
                newRow.remove();
                calculateEditProductCost();
            });
            
            newRow.querySelector('.material-quantity').addEventListener('input', function() {
                calculateEditProductMaterialTotal(newRow);
            });
            
            newRow.querySelector('.material-select').addEventListener('change', function() {
                const materialId = this.value;
                const material = appState.materials.find(m => m.id === materialId);
                if (material) {
                    calculateEditProductMaterialTotal(newRow);
                }
            });
        }
        
        function calculateItemTotal(row) {
            const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
            const unitPrice = parseFloat(row.querySelector('.unit-price').value) || 0;
            
            const total = quantity * unitPrice;
            
            calculateSaleTotals();
        }
        
        function calculateEditItemTotal(row) {
            const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
            const unitPrice = parseFloat(row.querySelector('.unit-price').value) || 0;
            
            const total = quantity * unitPrice;
            
            calculateEditSaleTotals();
        }
        
        function calculateProductMaterialTotal(row) {
            const quantity = parseFloat(row.querySelector('.material-quantity').value) || 0;
            
            calculateProductCost();
        }
        
        function calculateEditProductMaterialTotal(row) {
            const quantity = parseFloat(row.querySelector('.material-quantity').value) || 0;
            
            calculateEditProductCost();
        }
        
        function calculateSaleTotals() {
            // This function is kept for compatibility but doesn't need to do anything
            // since we removed the subtotal and grand total from the sale form
        }
        
        function calculateEditSaleTotals() {
            // This function is kept for compatibility but doesn't need to do anything
            // since we removed the subtotal and grand total from the sale form
        }
        
        function calculateProductCost() {
            // This function is kept for compatibility but doesn't need to do anything
            // since we removed the cost calculation from the product form
        }
        
        function calculateEditProductCost() {
            // This function is kept for compatibility but doesn't need to do anything
            // since we removed the cost calculation from the product form
        }
        
        function saveSale() {
            const saleDate = document.getElementById('saleDate').value;
            const customer = document.getElementById('customer').value;
            const items = [];
            let total = 0;
            let cost = 0;
            
            // Collect items from the form
            document.querySelectorAll('#saleItems tr').forEach(row => {
                const productSelect = row.querySelector('.product-select');
                const productId = productSelect.value;
                const product = appState.products.find(p => p.id === productId);
                
                if (product && productId !== 'Select Product') {
                    const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    const unitPrice = parseFloat(row.querySelector('.unit-price').value) || 0;
                    const itemTotal = quantity * unitPrice;
                    
                    items.push({
                        productId,
                        productName: product.name,
                        quantity,
                        unitPrice,
                        total: itemTotal
                    });
                    
                    total += itemTotal;
                    cost += product.cost * quantity;
                    
                    // Update product stock
                    product.stock -= quantity;
                }
            });
            
            if (items.length === 0) {
                showToast('Please add at least one product to the sale', 'warning');
                return;
            }
            
            // Create sale object
            const sale = {
                id: 'S' + Date.now(),
                date: saleDate,
                customer,
                items,
                total,
                cost,
                profit: total - cost
            };
            
            // Add to sales array
            appState.sales.push(sale);
            saveSalesToStorage();
            saveProductsToStorage();
            
            // Update UI
            updateDashboardData('today');
            updateSalesTable();
            updateProductsTable();
            
            // Close modal and show success message
            bootstrap.Modal.getInstance(document.getElementById('addSaleModal')).hide();
            showToast('Sale saved successfully!', 'success');
            
            // Reset form
            document.getElementById('saleForm').reset();
            document.getElementById('saleDate').valueAsDate = new Date();
            document.getElementById('saleItems').innerHTML = `
                <tr class="sale-item-row">
                    <td>
                        <select class="form-select product-select">
                            <option selected>Select Product</option>
                        </select>
                    </td>
                    <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                    <td>
                        <div class="input-group">
                            <span class="input-group-text">₱</span>
                            <input type="number" class="form-control unit-price" value="0.00" step="0.01">
                        </div>
                    </td>
                    <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>
                </tr>
            `;
            populateProductSelects();
        }
        
        function saveProduct() {
            const name = document.getElementById('productName').value;
            const stock = parseInt(document.getElementById('productStock').value) || 0;
            
            if (!name) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            // Calculate product cost from materials
            let cost = 0;
            const materialsUsed = [];
            
            document.querySelectorAll('#productMaterials tr').forEach(row => {
                const materialSelect = row.querySelector('.material-select');
                const materialId = materialSelect.value;
                const material = appState.materials.find(m => m.id === materialId);
                
                if (material && materialId !== 'Select Material') {
                    const quantity = parseFloat(row.querySelector('.material-quantity').value) || 0;
                    
                    materialsUsed.push({
                        materialId,
                        materialName: material.name,
                        quantity
                    });
                }
            });
            
            // Calculate selling price with markup
            const markup = appState.settings.priceMarkup || 30;
            const price = cost * (1 + markup / 100);
            
            // Create product object
            const product = {
                id: 'P' + Date.now(),
                name,
                cost,
                stock,
                price,
                materialsUsed
            };
            
            // Add to products array
            appState.products.push(product);
            saveProductsToStorage();
            
            // Update UI
            updateProductsTable();
            populateProductSelects();
            
            // Close modal and show success message
            bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
            showToast('Product saved successfully!', 'success');
            
            // Reset form
            document.getElementById('productForm').reset();
            document.getElementById('productMaterials').innerHTML = `
                <tr class="product-material-row">
                    <td>
                        <select class="form-select material-select">
                            <option selected>Select Material</option>
                        </select>
                    </td>
                    <td><input type="number" class="form-control material-quantity" value="1" min="1"></td>
                    <td><button type="button" class="btn btn-sm btn-danger remove-product-material"><i class="bi bi-trash"></i></button></td>
                </tr>
            `;
            populateMaterialSelects();
        }
        
        function saveMaterial() {
            const name = document.getElementById('materialName').value;
            const category = document.getElementById('materialCategory').value;
            const unit = document.getElementById('materialUnit').value;
            const stock = parseInt(document.getElementById('materialStock').value) || 0;
            const description = document.getElementById('materialDescription').value;
            
            if (!name || !category || !unit) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            // Create material object
            const material = {
                id: 'M' + Date.now(),
                name,
                category,
                unit,
                stock,
                description
            };
            
            // Add to materials array
            appState.materials.push(material);
            saveMaterialsToStorage();
            
            // Update UI
            updateMaterialsTable();
            populateMaterialSelects();
            
            // Close modal and show success message
            bootstrap.Modal.getInstance(document.getElementById('addMaterialModal')).hide();
            showToast('Material saved successfully!', 'success');
            
            // Reset form
            document.getElementById('materialForm').reset();
        }
        
        function viewSale(saleId) {
            const sale = appState.sales.find(s => s.id === saleId);
            if (sale) {
                let itemsHTML = '';
                sale.items.forEach(item => {
                    itemsHTML += `
                        <div class="d-flex justify-content-between mb-2">
                            <span>${item.productName}</span>
                            <span>${item.quantity} x ${appState.currencySymbol}${item.unitPrice} = ${appState.currencySymbol}${item.total}</span>
                        </div>
                    `;
                });
                
                showToast(`Sale Details:<br>Date: ${sale.date}<br>Customer: ${sale.customer || 'N/A'}<br>Items: ${itemsHTML}<br>Total: ${appState.currencySymbol}${sale.total}<br>Profit: ${appState.currencySymbol}${sale.profit}`, 'info', 10000);
            }
        }
        
        function editSale(saleId) {
            const sale = appState.sales.find(s => s.id === saleId);
            if (sale) {
                appState.editingSale = sale;
                
                // Populate the edit form with sale data
                document.getElementById('editSaleId').value = sale.id;
                document.getElementById('editSaleDate').value = sale.date;
                document.getElementById('editCustomer').value = sale.customer || '';
                
                // Clear existing items
                document.getElementById('editSaleItems').innerHTML = '';
                
                // Add items to the form
                sale.items.forEach(item => {
                    addEditSaleItem();
                    const lastRow = document.querySelector('#editSaleItems tr:last-child');
                    const product = appState.products.find(p => p.id === item.productId);
                    
                    if (lastRow && product) {
                        lastRow.querySelector('.product-select').value = item.productId;
                        lastRow.querySelector('.quantity').value = item.quantity;
                        lastRow.querySelector('.unit-price').value = item.unitPrice;
                    }
                });
                
                // Show the edit modal
                const editModal = new bootstrap.Modal(document.getElementById('editSaleModal'));
                editModal.show();
            }
        }
        
        function updateSale() {
            if (!appState.editingSale) return;
            
            const saleId = document.getElementById('editSaleId').value;
            const saleDate = document.getElementById('editSaleDate').value;
            const customer = document.getElementById('editCustomer').value;
            const items = [];
            let total = 0;
            let cost = 0;
            
            // Collect items from the form
            document.querySelectorAll('#editSaleItems tr').forEach(row => {
                const productSelect = row.querySelector('.product-select');
                const productId = productSelect.value;
                const product = appState.products.find(p => p.id === productId);
                
                if (product && productId !== 'Select Product') {
                    const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    const unitPrice = parseFloat(row.querySelector('.unit-price').value) || 0;
                    const itemTotal = quantity * unitPrice;
                    
                    items.push({
                        productId,
                        productName: product.name,
                        quantity,
                        unitPrice,
                        total: itemTotal
                    });
                    
                    total += itemTotal;
                    cost += product.cost * quantity;
                }
            });
            
            if (items.length === 0) {
                showToast('Please add at least one product to the sale', 'warning');
                return;
            }
            
            // Update sale object
            const saleIndex = appState.sales.findIndex(s => s.id === saleId);
            if (saleIndex !== -1) {
                appState.sales[saleIndex].date = saleDate;
                appState.sales[saleIndex].customer = customer;
                appState.sales[saleIndex].items = items;
                appState.sales[saleIndex].total = total;
                appState.sales[saleIndex].cost = cost;
                appState.sales[saleIndex].profit = total - cost;
                
                saveSalesToStorage();
                
                // Update UI
                updateDashboardData('today');
                updateSalesTable();
                
                // Close modal and show success message
                bootstrap.Modal.getInstance(document.getElementById('editSaleModal')).hide();
                showToast('Sale updated successfully!', 'success');
            }
        }
        
        function viewProduct(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (product) {
                let materialsHTML = '';
                if (product.materialsUsed && product.materialsUsed.length > 0) {
                    materialsHTML = '<div class="mt-3"><strong>Materials Used:</strong>';
                    product.materialsUsed.forEach(material => {
                        materialsHTML += `
                            <div class="d-flex justify-content-between mb-2">
                                <span>${material.materialName}</span>
                                <span>${material.quantity}</span>
                            </div>
                        `;
                    });
                    materialsHTML += '</div>';
                }
                
                showToast(`Product Details:<br>Name: ${product.name}<br>Stock: ${product.stock}${materialsHTML}`, 'info', 10000);
            }
        }
        
        function editProduct(productId) {
            const product = appState.products.find(p => p.id === productId);
            if (product) {
                appState.editingProduct = product;
                
                // Populate the edit form with product data
                document.getElementById('editProductId').value = product.id;
                document.getElementById('editProductName').value = product.name;
                document.getElementById('editProductStock').value = product.stock;
                
                // Clear existing materials
                document.getElementById('editProductMaterials').innerHTML = '';
                
                // Add materials to the form
                product.materialsUsed.forEach(material => {
                    addEditProductMaterial();
                    const lastRow = document.querySelector('#editProductMaterials tr:last-child');
                    const materialObj = appState.materials.find(m => m.id === material.materialId);
                    
                    if (lastRow && materialObj) {
                        lastRow.querySelector('.material-select').value = material.materialId;
                        lastRow.querySelector('.material-quantity').value = material.quantity;
                    }
                });
                
                // Show the edit modal
                const editModal = new bootstrap.Modal(document.getElementById('editProductModal'));
                editModal.show();
            }
        }
        
        function updateProduct() {
            if (!appState.editingProduct) return;
            
            const productId = document.getElementById('editProductId').value;
            const name = document.getElementById('editProductName').value;
            const stock = parseInt(document.getElementById('editProductStock').value) || 0;
            
            if (!name) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            // Calculate product cost from materials
            let cost = 0;
            const materialsUsed = [];
            
            document.querySelectorAll('#editProductMaterials tr').forEach(row => {
                const materialSelect = row.querySelector('.material-select');
                const materialId = materialSelect.value;
                const material = appState.materials.find(m => m.id === materialId);
                
                if (material && materialId !== 'Select Material') {
                    const quantity = parseFloat(row.querySelector('.material-quantity').value) || 0;
                    
                    materialsUsed.push({
                        materialId,
                        materialName: material.name,
                        quantity
                    });
                }
            });
            
            // Calculate selling price with markup
            const markup = appState.settings.priceMarkup || 30;
            const price = cost * (1 + markup / 100);
            
            // Update product object
            const productIndex = appState.products.findIndex(p => p.id === productId);
            if (productIndex !== -1) {
                appState.products[productIndex].name = name;
                appState.products[productIndex].cost = cost;
                appState.products[productIndex].stock = stock;
                appState.products[productIndex].price = price;
                appState.products[productIndex].materialsUsed = materialsUsed;
                
                saveProductsToStorage();
                
                // Update UI
                updateProductsTable();
                populateProductSelects();
                
                // Close modal and show success message
                bootstrap.Modal.getInstance(document.getElementById('editProductModal')).hide();
                showToast('Product updated successfully!', 'success');
            }
        }
        
        function viewMaterial(materialId) {
            const material = appState.materials.find(m => m.id === materialId);
            if (material) {
                showToast(`Material Details:<br>Name: ${material.name}<br>Category: ${material.category}<br>Unit: ${material.unit}<br>Stock: ${material.stock}<br>Description: ${material.description || 'N/A'}`, 'info', 10000);
            }
        }
        
        function editMaterial(materialId) {
            const material = appState.materials.find(m => m.id === materialId);
            if (material) {
                appState.editingMaterial = material;
                
                // Populate the edit form with material data
                document.getElementById('editMaterialId').value = material.id;
                document.getElementById('editMaterialName').value = material.name;
                document.getElementById('editMaterialCategory').value = material.category;
                document.getElementById('editMaterialUnit').value = material.unit;
                document.getElementById('editMaterialStock').value = material.stock;
                document.getElementById('editMaterialDescription').value = material.description || '';
                
                // Show the edit modal
                const editModal = new bootstrap.Modal(document.getElementById('editMaterialModal'));
                editModal.show();
            }
        }
        
        function updateMaterial() {
            if (!appState.editingMaterial) return;
            
            const materialId = document.getElementById('editMaterialId').value;
            const name = document.getElementById('editMaterialName').value;
            const category = document.getElementById('editMaterialCategory').value;
            const unit = document.getElementById('editMaterialUnit').value;
            const stock = parseInt(document.getElementById('editMaterialStock').value) || 0;
            const description = document.getElementById('editMaterialDescription').value;
            
            if (!name || !category || !unit) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            // Update material object
            const materialIndex = appState.materials.findIndex(m => m.id === materialId);
            if (materialIndex !== -1) {
                appState.materials[materialIndex].name = name;
                appState.materials[materialIndex].category = category;
                appState.materials[materialIndex].unit = unit;
                appState.materials[materialIndex].stock = stock;
                appState.materials[materialIndex].description = description;
                
                saveMaterialsToStorage();
                
                // Update UI
                updateMaterialsTable();
                populateMaterialSelects();
                
                // Close modal and show success message
                bootstrap.Modal.getInstance(document.getElementById('editMaterialModal')).hide();
                showToast('Material updated successfully!', 'success');
            }
        }
        
        function showDeleteConfirmation(type, id, message) {
            // Store the type and id for the delete action
            appState.deleteTarget.type = type;
            appState.deleteTarget.id = id;
            document.getElementById('deleteConfirmationMessage').textContent = message;
            
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            deleteModal.show();
        }
        
        function confirmDelete() {
            const type = appState.deleteTarget.type;
            const id = appState.deleteTarget.id;
            
            if (type === 'sale') {
                deleteSale(id);
            } else if (type === 'product') {
                deleteProduct(id);
            } else if (type === 'material') {
                deleteMaterial(id);
            }
            
            bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal')).hide();
        }
        
        function deleteSale(saleId) {
            appState.sales = appState.sales.filter(s => s.id !== saleId);
            saveSalesToStorage();
            updateSalesTable();
            updateDashboardData('today');
            showToast('Sale deleted successfully!', 'success');
        }
        
        function deleteProduct(productId) {
            appState.products = appState.products.filter(p => p.id !== productId);
            saveProductsToStorage();
            updateProductsTable();
            populateProductSelects();
            showToast('Product deleted successfully!', 'success');
        }
        
        function deleteMaterial(materialId) {
            appState.materials = appState.materials.filter(m => m.id !== materialId);
            saveMaterialsToStorage();
            updateMaterialsTable();
            populateMaterialSelects();
            showToast('Material deleted successfully!', 'success');
        }
        
        function deleteAllSales() {
            appState.sales = [];
            saveSalesToStorage();
            updateSalesTable();
            updateDashboardData('today');
            showToast('All sales have been deleted', 'success');
            
            // Reset checkbox
            document.getElementById('confirmDeleteSales').checked = false;
            document.getElementById('deleteSalesBtn').disabled = true;
        }
        
        function deleteAllProducts() {
            appState.products = [];
            saveProductsToStorage();
            updateProductsTable();
            populateProductSelects();
            showToast('All products have been deleted', 'success');
            
            // Reset checkbox
            document.getElementById('confirmDeleteProducts').checked = false;
            document.getElementById('deleteProductsBtn').disabled = true;
        }
        
        function deleteAllMaterials() {
            appState.materials = [];
            saveMaterialsToStorage();
            updateMaterialsTable();
            populateMaterialSelects();
            showToast('All materials have been deleted', 'success');
            
            // Reset checkbox
            document.getElementById('confirmDeleteMaterials').checked = false;
            document.getElementById('deleteMaterialsBtn').disabled = true;
        }
        
        function deleteAllData() {
            appState.sales = [];
            appState.products = [];
            appState.materials = [];
            saveSalesToStorage();
            saveProductsToStorage();
            saveMaterialsToStorage();
            
            updateSalesTable();
            updateProductsTable();
            updateMaterialsTable();
            updateDashboardData('today');
            
            showToast('All system data has been deleted', 'success');
            
            // Reset checkbox
            document.getElementById('confirmDeleteAll').checked = false;
            document.getElementById('deleteAllBtn').disabled = true;
        }
        
        function loadSettingsForm() {
            document.getElementById('companyName').value = appState.settings.companyName;
            document.getElementById('currency').value = appState.settings.currency;
            document.getElementById('taxRate').value = appState.settings.taxRate;
            document.getElementById('lowStockAlert').checked = appState.settings.lowStockAlert;
            document.getElementById('lowStockThreshold').value = appState.settings.lowStockThreshold;
            document.getElementById('priceMarkup').value = appState.settings.priceMarkup;
        }
        
        function saveSettings() {
            appState.settings.companyName = document.getElementById('companyName').value;
            appState.settings.currency = document.getElementById('currency').value;
            appState.settings.taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            appState.settings.lowStockAlert = document.getElementById('lowStockAlert').checked;
            appState.settings.lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value) || 10;
            appState.settings.priceMarkup = parseFloat(document.getElementById('priceMarkup').value) || 30;
            
            saveSettingsToStorage();
            
            // Update product prices with new markup
            appState.products.forEach(product => {
                product.price = product.cost * (1 + appState.settings.priceMarkup / 100);
            });
            saveProductsToStorage();
            updateProductsTable();
            
            showToast('Settings saved successfully!', 'success');
            
            // Close the modal
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
        }
        
        function loadAccountForm() {
            if (appState.currentUser) {
                document.getElementById('adminUsername').value = appState.currentUser.username;
                document.getElementById('adminEmail').value = appState.currentUser.email;
            }
        }
        
        function updateAccount() {
            const username = document.getElementById('adminUsername').value;
            const email = document.getElementById('adminEmail').value;
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!username || !email) {
                showToast('Please fill in username and email', 'warning');
                return;
            }
            
            // Check if username already exists (if changed)
            if (username !== appState.currentUser.username) {
                if (appState.users.find(u => u.username === username && u !== appState.currentUser)) {
                    showToast('Username already exists', 'warning');
                    return;
                }
            }
            
            // Update user data
            appState.currentUser.username = username;
            appState.currentUser.email = email;
            
            // Update password if provided
            if (currentPassword && newPassword) {
                if (currentPassword !== appState.currentUser.password) {
                    showToast('Current password is incorrect', 'danger');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showToast('New passwords do not match', 'warning');
                    return;
                }
                
                appState.currentUser.password = newPassword;
            }
            
            // Update users array
            const userIndex = appState.users.findIndex(u => u.username === appState.currentUser.username);
            if (userIndex !== -1) {
                appState.users[userIndex] = appState.currentUser;
            }
            
            saveUsersToStorage();
            saveCurrentUserToStorage();
            currentUsername.textContent = username;
            
            // Clear password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            showToast('Account updated successfully!', 'success');
        }
        
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            // Update report title
            document.getElementById('reportTitle').textContent = 
                reportType.charAt(0).toUpperCase() + reportType.slice(1) + ' Report';
            
            // Filter data based on date range
            let filteredData = appState.sales;
            if (dateFrom && dateTo) {
                filteredData = appState.sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    const fromDate = new Date(dateFrom);
                    const toDate = new Date(dateTo);
                    return saleDate >= fromDate && saleDate <= toDate;
                });
            }
            
            // Calculate report data
            let totalRevenue = 0;
            let totalCost = 0;
            let totalProfit = 0;
            
            filteredData.forEach(sale => {
                totalRevenue += sale.total;
                totalCost += sale.cost;
                totalProfit += sale.profit;
            });
            
            // Update report summary
            document.querySelector('.revenue.currency').textContent = totalRevenue.toFixed(2);
            document.querySelector('.cost.currency').textContent = totalCost.toFixed(2);
            document.querySelector('.profit.currency').textContent = totalProfit.toFixed(2);
            
            // Update chart data based on filtered data
            updateChartData();
            
            showToast('Report generated successfully!', 'success');
        }
        
        function exportToCsv() {
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // Add headers
            csvContent += "ID,Date,Customer,Items,Total,Profit\n";
            
            // Add data
            appState.sales.forEach(sale => {
                const row = [
                    sale.id,
                    sale.date,
                    sale.customer || 'N/A',
                    sale.items.length,
                    sale.total,
                    sale.profit
                ].join(',');
                csvContent += row + "\n";
            });
            
            // Create download link
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "sales_data.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('CSV file downloaded successfully!', 'success');
        }
        
        function exportToPdf() {
            // Use jsPDF to generate PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('NoodleCost Sales Report', 20, 20);
            
            // Add date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 30);
            
            // Add table
            const tableColumn = ["ID", "Date", "Customer", "Items", "Total", "Profit"];
            const tableRows = [];
            
            appState.sales.forEach(sale => {
                const saleData = [
                    sale.id,
                    sale.date,
                    sale.customer || 'N/A',
                    sale.items.length.toString(),
                    `${appState.currencySymbol}${sale.total.toFixed(2)}`,
                    `${appState.currencySymbol}${sale.profit.toFixed(2)}`
                ];
                tableRows.push(saleData);
            });
            
            // Add table to PDF
            doc.autoTable({
                head: [tableColumn],
                body: tableRows,
                startY: 40,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [184, 224, 210] }
            });
            
            // Save the PDF
            doc.save('noodecost_sales_report.pdf');
            showToast('PDF report downloaded successfully!', 'success');
        }
        
        function searchSales() {
            const query = document.getElementById('salesSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#salesTableBody tr');
            let hasResults = false;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query)) {
                    row.style.display = '';
                    hasResults = true;
                } else {
                    row.style.display = 'none';
                }
            });
            
            if (!hasResults) {
                document.getElementById('salesTableBody').innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center text-muted py-4">No sales records found matching "${query}"</td>
                    </tr>
                `;
            }
        }
        
        function searchProducts() {
            const query = document.getElementById('productsSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#productsTableBody tr');
            let hasResults = false;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query)) {
                    row.style.display = '';
                    hasResults = true;
                } else {
                    row.style.display = 'none';
                }
            });
            
            if (!hasResults) {
                document.getElementById('productsTableBody').innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-muted py-4">No products found matching "${query}"</td>
                    </tr>
                `;
            }
        }
        
        function searchMaterials() {
            const query = document.getElementById('materialsSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#materialsTableBody tr');
            let hasResults = false;
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query)) {
                    row.style.display = '';
                    hasResults = true;
                } else {
                    row.style.display = 'none';
                }
            });
            
            if (!hasResults) {
                document.getElementById('materialsTableBody').innerHTML = `
                    <tr>
                        <td colspan="4" class="text-center text-muted py-4">No materials found matching "${query}"</td>
                    </tr>
                `;
            }
        }
        
        function downloadAllData() {
            const data = {
                users: appState.users,
                sales: appState.sales,
                products: appState.products,
                materials: appState.materials,
                settings: appState.settings
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'noodecost_data.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('All data downloaded successfully!', 'success');
        }
        
        function uploadData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate the data structure
                    if (data.users && data.sales && data.products && data.materials && data.settings) {
                        appState.users = data.users;
                        appState.sales = data.sales;
                        appState.products = data.products;
                        appState.materials = data.materials;
                        appState.settings = data.settings;
                        
                        // Save to localStorage
                        saveUsersToStorage();
                        saveSalesToStorage();
                        saveProductsToStorage();
                        saveMaterialsToStorage();
                        saveSettingsToStorage();
                        
                        // Update UI
                        updateDashboardData('today');
                        updateSalesTable();
                        updateProductsTable();
                        updateMaterialsTable();
                        populateProductSelects();
                        populateMaterialSelects();
                        loadSettingsForm();
                        
                        showToast('Data uploaded successfully!', 'success');
                    } else {
                        showToast('Invalid data file format', 'danger');
                    }
                } catch (error) {
                    showToast('Error parsing data file', 'danger');
                }
            };
            reader.readAsText(file);
            
            // Reset the file input
            event.target.value = '';
        }
        
        function toggleDarkMode() {
            appState.darkMode = !appState.darkMode;
            applyTheme();
            saveThemeToStorage();
        }
        
        function applyTheme() {
            if (appState.darkMode) {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="bi bi-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode');
                themeToggle.innerHTML = '<i class="bi bi-moon"></i>';
            }
        }
        
        function showToast(message, type = 'info', duration = 5000) {
            toastMessage.innerHTML = message;
            
            // Update toast color based on type
            const toastHeader = toastEl.querySelector('.toast-header');
            toastHeader.className = 'toast-header';
            
            if (type === 'success') {
                toastHeader.classList.add('text-success');
            } else if (type === 'warning') {
                toastHeader.classList.add('text-warning');
            } else if (type === 'danger') {
                toastHeader.classList.add('text-danger');
            } else {
                toastHeader.classList.add('text-primary');
            }
            
            // Set auto-hide duration
            toast._config.delay = duration;
            toast.show();
        }
    </script>
</body>
</html>