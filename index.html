<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korean Food Business | Inventory & Sales</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50; --primary-light: #34495e; --secondary: #7f8c8d;
            --success: #27ae60; --info: #3498db; --warning: #f39c12; --danger: #e74c3c;
            --light: #f8f9fa; --dark: #212529;
            --dark-bg: #121212; --dark-card: #1e1e1e; --dark-text: #e0e0e0;
            --dark-border: #333333; --dark-primary: #2c3e50; --dark-secondary: #7f8c8d;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; font-family: 'Poppins', 'Noto Sans KR', sans-serif; }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e7eb 100%);
            color: var(--dark); display: flex; flex-direction: column;
            min-height: 100vh; padding-top: 56px; transition: all 0.3s ease;
        }
        body.dark-mode { background: linear-gradient(135deg, #1e1e1e 0%, #2c2c2c 100%); color: var(--dark-text); }
        
        .navbar-brand { font-weight: 700; color: var(--dark) !important; }
        .dark-mode .navbar { background-color: var(--dark-card) !important; border-bottom: 1px solid var(--dark-border); }
        .dark-mode .navbar-brand, .dark-mode .nav-link { color: var(--dark-text) !important; }
        
        .sidebar {
            background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); border-radius: 10px; padding: 20px 0;
            height: calc(100vh - 120px); overflow-y: auto; position: sticky; top: 80px;
        }
        .dark-mode .sidebar { background-color: rgba(30, 30, 30, 0.95); box-shadow: 0 0 20px rgba(0, 0, 0, 0.3); }
        
        .sidebar .nav-link {
            color: var(--dark); padding: 12px 20px; margin: 5px 0; border-radius: 8px;
            transition: all 0.3s ease; font-weight: 500;
        }
        .dark-mode .sidebar .nav-link { color: var(--dark-text); }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white; transform: translateX(5px);
        }
        .sidebar .nav-link i { margin-right: 10px; width: 20px; text-align: center; }
        
        .card {
            border: none; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease; margin-bottom: 20px;
            background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
        }
        .dark-mode .card { background-color: rgba(30, 30, 30, 0.95); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12); }
        .dark-mode .card:hover { box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-bottom: none; border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px; font-weight: 600; color: white;
        }
        .dark-mode .card-header { background: linear-gradient(135deg, var(--dark-primary) 0%, var(--dark-secondary) 100%); }
        
        .kpi-card { text-align: center; padding: 25px 15px; border-left: 4px solid var(--primary); }
        .kpi-card.revenue { border-left-color: var(--success); }
        .kpi-card.cost { border-left-color: var(--danger); }
        .kpi-card.profit { border-left-color: var(--info); }
        .kpi-card.sales { border-left-color: var(--warning); }
        
        .kpi-value { font-size: 2rem; font-weight: 700; margin: 10px 0; }
        .kpi-label { font-size: 0.9rem; color: #6c757d; font-weight: 500; }
        .dark-mode .kpi-label { color: #a0a0a0; }
        .revenue { color: var(--success); } .cost { color: var(--danger); }
        .profit { color: var(--info); } .sales { color: var(--warning); }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border: none; color: white; font-weight: 500; border-radius: 8px;
            padding: 10px 20px; transition: all 0.3s ease;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(44, 62, 80, 0.4); }
        .dark-mode .btn-primary { background: linear-gradient(135deg, var(--dark-primary) 0%, var(--dark-secondary) 100%); }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%); border: none;
        }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4); }
        
        .table { border-radius: 8px; overflow: hidden; background-color: white; }
        .dark-mode .table { background-color: var(--dark-card); color: var(--dark-text); }
        
        .table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border: none; font-weight: 600; color: white; padding: 15px;
        }
        .dark-mode .table th { background: linear-gradient(135deg, var(--dark-primary) 0%, var(--dark-secondary) 100%); }
        .table td { border: none; padding: 12px 15px; vertical-align: middle; }
        .dark-mode .table td { border-bottom: 1px solid var(--dark-border); }
        
        .table tbody tr { transition: background-color 0.2s ease; }
        .table tbody tr:hover { background-color: rgba(44, 62, 80, 0.05); }
        .dark-mode .table tbody tr:hover { background-color: rgba(44, 62, 80, 0.1); }
        
        .login-container {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        }
        .dark-mode .login-container { background: linear-gradient(135deg, var(--dark-primary) 0%, var(--dark-secondary) 100%); }
        
        .login-card {
            background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border-radius: 15px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px; width: 100%; max-width: 400px;
        }
        .dark-mode .login-card { background-color: rgba(30, 30, 30, 0.95); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3); }
        
        .form-control, .form-select {
            border-radius: 8px; border: 1px solid #e0e0e0; padding: 12px 15px;
            background-color: white; color: var(--dark); transition: all 0.3s ease;
        }
        .dark-mode .form-control, .dark-mode .form-select {
            background-color: #2a2a2a; border: 1px solid var(--dark-border); color: var(--dark-text);
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--primary); box-shadow: 0 0 0 0.2rem rgba(44, 62, 80, 0.25);
        }
        .dark-mode .form-control:focus, .dark-mode .form-select:focus { border-color: var(--dark-primary); }
        
        footer {
            background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            padding: 20px 0; border-top: 1px solid rgba(0, 0, 0, 0.1);
            margin-top: auto; width: 100%;
        }
        .dark-mode footer { background-color: rgba(30, 30, 30, 0.95); border-top: 1px solid var(--dark-border); }
        
        .main-content { flex: 1; padding-bottom: 20px; }
        .page-transition { animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .currency::before { content: "₱"; }
        .chart-container { position: relative; height: 300px; width: 100%; }
        
        .material-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 768px) { .material-form-grid { grid-template-columns: 1fr; } }
        
        .empty-state { text-align: center; padding: 40px 20px; color: #6c757d; }
        .dark-mode .empty-state { color: #a0a0a0; }
        .empty-state i { font-size: 3rem; margin-bottom: 15px; opacity: 0.5; }
        
        .theme-toggle { cursor: pointer; font-size: 1.2rem; margin-right: 10px; transition: all 0.3s ease; }
        .theme-toggle:hover { transform: rotate(15deg); }
        
        @media (max-width: 768px) {
            .sidebar { margin-bottom: 20px; height: auto; position: static; }
        }
    </style>
</head>
<body>
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="bi bi-info-circle text-primary me-2"></i>
                <strong class="me-auto">System Notification</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">Welcome to Korean Food Business Management!</div>
        </div>
    </div>

    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="text-center mb-4">
                <h2 class="fw-bold">Korean Food Business</h2>
                <p class="text-muted">Inventory & Sales Management</p>
            </div>
            <form id="loginForm">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" placeholder="Enter username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter password" required>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-2">Login</button>
            </form>
        </div>
    </div>

    <div id="mainApp" class="d-none d-flex flex-column min-vh-100">
        <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
            <div class="container-fluid">
                <a class="navbar-brand" href="#"><i class="bi bi-graph-up"></i> Korean Food Business</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <span class="nav-link theme-toggle" id="themeToggle"><i class="bi bi-moon"></i></span>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="bi bi-person-circle"></i> <span id="currentUsername">Admin</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal"><i class="bi bi-gear"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="main-content">
            <div class="container-fluid mt-4">
                <div class="row">
                    <div class="col-lg-2">
                        <div class="sidebar">
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <a class="nav-link active" href="#" data-page="dashboard">
                                        <i class="bi bi-speedometer2"></i> Dashboard
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="sales">
                                        <i class="bi bi-cart-check"></i> Sales
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="inventory">
                                        <i class="bi bi-box-seam"></i> Inventory
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#" data-page="reports">
                                        <i class="bi bi-bar-chart"></i> Reports
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="col-lg-10">
                        <div id="pageContent" class="page-transition">
                            <div id="dashboardPage" class="page">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Dashboard</h3>
                                    <div class="btn-group">
                                        <button class="btn btn-outline-secondary active" data-period="today">Today</button>
                                        <button class="btn btn-outline-secondary" data-period="week">Week</button>
                                        <button class="btn btn-outline-secondary" data-period="month">Month</button>
                                        <button class="btn btn-outline-secondary" data-period="year">Year</button>
                                    </div>
                                </div>

                                <div class="row dashboard-stats-row">
                                    <div class="col-md-3">
                                        <div class="card kpi-card revenue">
                                            <div class="kpi-value revenue currency">0</div>
                                            <div class="kpi-label">Total Revenue</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card kpi-card cost">
                                            <div class="kpi-value cost currency">0</div>
                                            <div class="kpi-label">Total Material Cost</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card kpi-card profit">
                                            <div class="kpi-value profit currency">0</div>
                                            <div class="kpi-label">Gross Profit</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card kpi-card sales">
                                            <div class="kpi-value sales">0</div>
                                            <div class="kpi-label">Total Sales</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row dashboard-charts-row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">Sales Performance</div>
                                            <div class="card-body">
                                                <div class="chart-container"><canvas id="salesChart"></canvas></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">Top Selling Items</div>
                                            <div class="card-body">
                                                <div id="topSellingItems" class="empty-state">
                                                    <i class="bi bi-graph-up"></i>
                                                    <p>No sales data available</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row dashboard-alerts-row">
                                    <div class="col-md-8">
                                        <div class="card">
                                            <div class="card-header">Recent Sales</div>
                                            <div class="card-body">
                                                <div id="recentSales" class="empty-state">
                                                    <i class="bi bi-cart-check"></i>
                                                    <p>No recent sales</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card">
                                            <div class="card-header">Low Stock Alerts</div>
                                            <div class="card-body" id="lowStockAlerts">
                                                <div class="empty-state">
                                                    <i class="bi bi-check-circle"></i>
                                                    <p>No low stock alerts</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="salesPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Sales Management</h3>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSaleModal">
                                        <i class="bi bi-plus-circle"></i> New Sale
                                    </button>
                                </div>

                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>Recent Sales</span>
                                        <div class="input-group" style="width: 300px;">
                                            <input type="text" class="form-control" id="salesSearch" placeholder="Search sales...">
                                            <button class="btn btn-outline-secondary" type="button" id="salesSearchBtn">
                                                <i class="bi bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th><th>Date</th><th>Customer</th><th>Items</th>
                                                        <th>Total Amount</th><th>Material Cost</th><th>Profit</th><th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="salesTableBody">
                                                    <tr><td colspan="8" class="text-center text-muted py-4">No sales records found</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="inventoryPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Inventory Management</h3>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMaterialModal">
                                        <i class="bi bi-plus-circle"></i> Add Material
                                    </button>
                                </div>

                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span>Material List</span>
                                        <div class="input-group" style="width: 300px;">
                                            <input type="text" class="form-control" id="materialsSearch" placeholder="Search materials...">
                                            <button class="btn btn-outline-secondary" type="button" id="materialsSearchBtn">
                                                <i class="bi bi-search"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>ID</th><th>Name</th><th>Category</th><th>Stock</th>
                                                        <th>Box Price</th><th>Pieces per Box</th><th>Cost per Piece</th><th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="materialsTableBody">
                                                    <tr><td colspan="8" class="text-center text-muted py-4">No materials found</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="reportsPage" class="page d-none">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h3 class="fw-bold">Reports & Analytics</h3>
                                    <div>
                                        <button class="btn btn-outline-primary" id="exportCsvBtn">
                                            <i class="bi bi-download"></i> Export CSV
                                        </button>
                                        <button class="btn btn-outline-primary" id="exportPdfBtn">
                                            <i class="bi bi-file-pdf"></i> Export PDF
                                        </button>
                                    </div>
                                </div>

                                <div class="row mb-4">
                                    <div class="col-md-3">
                                        <label for="reportType" class="form-label">Report Type</label>
                                        <select class="form-select" id="reportType">
                                            <option value="sales" selected>Sales Report</option>
                                            <option value="profit">Profit Report</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="dateFrom" class="form-label">From Date</label>
                                        <input type="date" class="form-control" id="dateFrom">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="dateTo" class="form-label">To Date</label>
                                        <input type="date" class="form-control" id="dateTo">
                                    </div>
                                    <div class="col-md-3 d-flex align-items-end">
                                        <button class="btn btn-primary w-100" id="generateReportBtn">Generate Report</button>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header" id="reportTitle">Sales Report</div>
                                    <div class="card-body">
                                        <div class="chart-container"><canvas id="reportChart"></canvas></div>
                                    </div>
                                </div>

                                <div class="card mt-4">
                                    <div class="card-header">Report Summary</div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <h5>Total Sales</h5>
                                                <p class="fs-4 text-success currency">0</p>
                                            </div>
                                            <div class="col-md-4">
                                                <h5>Total Material Cost</h5>
                                                <p class="fs-4 text-danger currency">0</p>
                                            </div>
                                            <div class="col-md-4">
                                                <h5>Gross Profit</h5>
                                                <p class="fs-4 text-info currency">0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12 text-center">
                        <p class="mb-0">&copy; 2025 Korean Food Business. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="addSaleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">New Sale</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="saleForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="saleDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="saleDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="customer" class="form-label">Name (Optional)</label>
                                <input type="text" class="form-control" id="customer" placeholder="Customer name">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Sales Item</h6>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="addItem">
                                    <i class="bi bi-plus-circle"></i> Add Item
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead><tr><th>Name</th><th>Qty</th><th>Action</th></tr></thead>
                                    <tbody id="saleItems">
                                        <tr class="sale-item-row">
                                            <td><select class="form-select material-select"><option selected>Select Material</option></select></td>
                                            <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                                            <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="salePrice" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text">₱</span>
                                <input type="number" class="form-control" id="salePrice" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        
                        <div class="sale-summary-card">
                            <h6 class="mb-3">Sale Summary</h6>
                            <div class="row">
                                <div class="col-md-6"><p><strong>Material Cost:</strong> <span id="saleMaterialCost" class="currency">0.00</span></p></div>
                                <div class="col-md-6">
                                    <p><strong>Sale Price:</strong> <span id="salePriceDisplay" class="currency">0.00</span></p>
                                    <p><strong>Profit:</strong> <span id="saleProfit" class="currency">0.00</span></p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSaleBtn">Save Sale</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade edit-modal" id="editSaleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Edit Sale</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="editSaleForm">
                        <input type="hidden" id="editSaleId">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="editSaleDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="editSaleDate" required>
                            </div>
                            <div class="col-md-6">
                                <label for="editCustomer" class="form-label">Name (Optional)</label>
                                <input type="text" class="form-control" id="editCustomer" placeholder="Customer name">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Sales Item</h6>
                                <button type="button" class="btn btn-outline-primary btn-sm" id="editAddItem">
                                    <i class="bi bi-plus-circle"></i> Add Item
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead><tr><th>Name</th><th>Qty</th><th>Action</th></tr></thead>
                                    <tbody id="editSaleItems"></tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="editSalePrice" class="form-label">Price</label>
                            <div class="input-group">
                                <span class="input-group-text">₱</span>
                                <input type="number" class="form-control" id="editSalePrice" step="0.01" placeholder="0.00" required>
                            </div>
                        </div>
                        
                        <div class="sale-summary-card">
                            <h6 class="mb-3">Sale Summary</h6>
                            <div class="row">
                                <div class="col-md-6"><p><strong>Material Cost:</strong> <span id="editSaleMaterialCost" class="currency">0.00</span></p></div>
                                <div class="col-md-6">
                                    <p><strong>Sale Price:</strong> <span id="editSalePriceDisplay" class="currency">0.00</span></p>
                                    <p><strong>Profit:</strong> <span id="editSaleProfit" class="currency">0.00</span></p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateSaleBtn">Update Sale</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addMaterialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Add Material</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="materialForm">
                        <div class="material-form-grid">
                            <div class="mb-3"><label for="materialName" class="form-label">Material Name</label><input type="text" class="form-control" id="materialName" required></div>
                            <div class="mb-3"><label for="materialCategory" class="form-label">Category</label><input type="text" class="form-control" id="materialCategory" required></div>
                            <div class="mb-3"><label for="materialStock" class="form-label">Stock Quantity</label><input type="number" class="form-control" id="materialStock" required></div>
                            <div class="mb-3"><label for="materialUnit" class="form-label">Unit</label><input type="text" class="form-control" id="materialUnit" required></div>
                            <div class="mb-3"><label for="boxPrice" class="form-label">Box Price</label><div class="input-group"><span class="input-group-text">₱</span><input type="number" class="form-control" id="boxPrice" step="0.01" required></div></div>
                            <div class="mb-3"><label for="piecesPerBox" class="form-label">Pieces per Box</label><input type="number" class="form-control" id="piecesPerBox" required></div>
                        </div>
                        <div class="mb-3">
                            <label for="costPerPiece" class="form-label">Cost per Piece (Auto-calculated)</label>
                            <div class="input-group"><span class="input-group-text">₱</span><input type="number" class="form-control" id="costPerPiece" step="0.01" readonly></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMaterialBtn">Save Material</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade edit-modal" id="editMaterialModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Edit Material</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <form id="editMaterialForm">
                        <input type="hidden" id="editMaterialId">
                        <div class="material-form-grid">
                            <div class="mb-3"><label for="editMaterialName" class="form-label">Material Name</label><input type="text" class="form-control" id="editMaterialName" required></div>
                            <div class="mb-3"><label for="editMaterialCategory" class="form-label">Category</label><input type="text" class="form-control" id="editMaterialCategory" required></div>
                            <div class="mb-3"><label for="editMaterialStock" class="form-label">Stock Quantity</label><input type="number" class="form-control" id="editMaterialStock" required></div>
                            <div class="mb-3"><label for="editMaterialUnit" class="form-label">Unit</label><input type="text" class="form-control" id="editMaterialUnit" required></div>
                            <div class="mb-3"><label for="editBoxPrice" class="form-label">Box Price</label><div class="input-group"><span class="input-group-text">₱</span><input type="number" class="form-control" id="editBoxPrice" step="0.01" required></div></div>
                            <div class="mb-3"><label for="editPiecesPerBox" class="form-label">Pieces per Box</label><input type="number" class="form-control" id="editPiecesPerBox" required></div>
                        </div>
                        <div class="mb-3">
                            <label for="editCostPerPiece" class="form-label">Cost per Piece (Auto-calculated)</label>
                            <div class="input-group"><span class="input-group-text">₱</span><input type="number" class="form-control" id="editCostPerPiece" step="0.01" readonly></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateMaterialBtn">Update Material</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade settings-modal" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">System Settings</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Application Settings</div>
                                <div class="card-body">
                                    <div class="mb-3"><label for="companyName" class="form-label">Business Name</label><input type="text" class="form-control" id="companyName" value="Korean Food Business"></div>
                                    <div class="mb-3"><label for="taxRate" class="form-label">Tax Rate (%)</label><input type="number" class="form-control" id="taxRate" value="12" step="0.1"></div>
                                    <div class="mb-3 form-check"><input type="checkbox" class="form-check-input" id="lowStockAlert" checked><label class="form-check-label" for="lowStockAlert">Enable low stock alerts</label></div>
                                    <div class="mb-3"><label for="lowStockThreshold" class="form-label">Low Stock Threshold</label><input type="number" class="form-control" id="lowStockThreshold" value="10"></div>
                                    <button class="btn btn-primary" id="saveSettingsBtn">Save Settings</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">Data Management</div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <button class="btn btn-outline-primary w-100 mb-2" id="downloadDataBtn"><i class="bi bi-download"></i> Download All Data</button>
                                        <button class="btn btn-outline-secondary w-100 mb-2" id="uploadDataBtn"><i class="bi bi-upload"></i> Upload Data</button>
                                        <input type="file" id="uploadDataInput" class="d-none" accept=".json">
                                    </div>
                                    <div class="delete-all-section">
                                        <h6 class="text-danger mb-3">Danger Zone</h6>
                                        <p class="small text-muted mb-3">This action cannot be undone. This will permanently delete all your sales, inventory, and settings data.</p>
                                        <button class="btn btn-danger w-100" id="deleteAllDataBtn"><i class="bi bi-exclamation-triangle"></i> Delete All Data</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade confirmation-modal" id="deleteConfirmationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-danger"><i class="bi bi-exclamation-triangle"></i> Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="fw-bold">Are you sure you want to delete ALL data?</p>
                    <p class="text-muted">This action will permanently delete:</p>
                    <ul><li>All sales records</li><li>All inventory materials</li><li>All settings and preferences</li></ul>
                    <p class="text-danger fw-bold">This action cannot be undone!</p>
                    <div class="mb-3">
                        <label for="confirmDeleteInput" class="form-label">Type "DELETE" to confirm:</label>
                        <input type="text" class="form-control" id="confirmDeleteInput" placeholder="Type DELETE here">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled>Delete All Data</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade confirmation-modal" id="logoutConfirmationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-box-arrow-right"></i> Confirm Logout</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="fw-bold">Are you sure you want to logout?</p>
                    <p class="text-muted">You will need to log in again to access the system.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmLogoutBtn">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        const appState = {
            currentPage: 'dashboard', isLoggedIn: false, currency: 'peso', currencySymbol: '₱', darkMode: false,
            users: [], currentUser: null, sales: [], materials: [],
            settings: { companyName: 'Korean Food Business', taxRate: 12, lowStockAlert: true, lowStockThreshold: 10 },
            editingSale: null, editingMaterial: null
        };

        const loginScreen = document.getElementById('loginScreen');
        const mainApp = document.getElementById('mainApp');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const sidebarLinks = document.querySelectorAll('.sidebar .nav-link');
        const pages = document.querySelectorAll('.page');
        const toastEl = document.getElementById('liveToast');
        const toastMessage = document.getElementById('toastMessage');
        const toast = new bootstrap.Toast(toastEl);
        const themeToggle = document.getElementById('themeToggle');
        const currentUsername = document.getElementById('currentUsername');
        
        let salesChart, reportChart;

        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            document.getElementById('saleDate').valueAsDate = new Date();
            document.getElementById('dateFrom').valueAsDate = new Date();
            document.getElementById('dateTo').valueAsDate = new Date();
            
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                if (username && password) login(username, password);
                else showToast('Please enter both username and password', 'warning');
            });
            
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                new bootstrap.Modal(document.getElementById('logoutConfirmationModal')).show();
            });
            
            document.getElementById('confirmLogoutBtn').addEventListener('click', function() {
                logout();
                bootstrap.Modal.getInstance(document.getElementById('logoutConfirmationModal')).hide();
            });
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    navigateToPage(this.getAttribute('data-page'));
                });
            });
            
            document.querySelectorAll('[data-period]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('[data-period]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateDashboardData(this.getAttribute('data-period'));
                });
            });
            
            document.getElementById('addItem').addEventListener('click', addSaleItem);
            document.getElementById('editAddItem').addEventListener('click', addEditSaleItem);
            
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-item')) {
                    e.target.closest('tr').remove();
                    calculateSaleTotals();
                }
                if (e.target.classList.contains('quantity')) calculateSaleTotals();
            });
            
            document.getElementById('salePrice').addEventListener('input', calculateSaleTotals);
            document.getElementById('editSalePrice').addEventListener('input', calculateEditSaleTotals);
            
            document.getElementById('boxPrice').addEventListener('input', calculateCostPerPiece);
            document.getElementById('piecesPerBox').addEventListener('input', calculateCostPerPiece);
            document.getElementById('editBoxPrice').addEventListener('input', calculateEditCostPerPiece);
            document.getElementById('editPiecesPerBox').addEventListener('input', calculateEditCostPerPiece);
            
            document.getElementById('saveSaleBtn').addEventListener('click', saveSale);
            document.getElementById('saveMaterialBtn').addEventListener('click', saveMaterial);
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            document.getElementById('updateSaleBtn').addEventListener('click', updateSale);
            document.getElementById('updateMaterialBtn').addEventListener('click', updateMaterial);
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('exportCsvBtn').addEventListener('click', exportToCsv);
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPdf);
            document.getElementById('salesSearchBtn').addEventListener('click', searchSales);
            document.getElementById('materialsSearchBtn').addEventListener('click', searchMaterials);
            document.getElementById('downloadDataBtn').addEventListener('click', downloadAllData);
            document.getElementById('uploadDataBtn').addEventListener('click', function() {
                document.getElementById('uploadDataInput').click();
            });
            document.getElementById('uploadDataInput').addEventListener('change', uploadData);
            document.getElementById('deleteAllDataBtn').addEventListener('click', showDeleteConfirmation);
            document.getElementById('confirmDeleteInput').addEventListener('input', function() {
                document.getElementById('confirmDeleteBtn').disabled = this.value.toUpperCase() !== 'DELETE';
            });
            document.getElementById('confirmDeleteBtn').addEventListener('click', deleteAllData);
            themeToggle.addEventListener('click', toggleDarkMode);
        });
        
        function initializeApp() {
            loadDataFromStorage();
            if (appState.currentUser) showMainApp();
            else showLoginScreen();
            applyTheme();
            initCharts();
            updateDashboardData('today');
            updateSalesTable();
            updateMaterialsTable();
            populateMaterialSelects();
            loadSettingsForm();
        }
        
        function loadDataFromStorage() {
            const storedUsers = localStorage.getItem('koreanFood_users');
            appState.users = storedUsers ? JSON.parse(storedUsers) : [{ username: 'admin', password: 'admin123' }];
            if (!storedUsers) saveUsersToStorage();
            
            const storedCurrentUser = localStorage.getItem('koreanFood_currentUser');
            if (storedCurrentUser) {
                appState.currentUser = JSON.parse(storedCurrentUser);
                currentUsername.textContent = appState.currentUser.username;
            }
            
            const storedSales = localStorage.getItem('koreanFood_sales');
            appState.sales = storedSales ? JSON.parse(storedSales) : [];
            
            const storedMaterials = localStorage.getItem('koreanFood_materials');
            appState.materials = storedMaterials ? JSON.parse(storedMaterials) : [];
            
            const storedSettings = localStorage.getItem('koreanFood_settings');
            appState.settings = storedSettings ? JSON.parse(storedSettings) : appState.settings;
            
            const storedTheme = localStorage.getItem('koreanFood_darkMode');
            if (storedTheme) appState.darkMode = JSON.parse(storedTheme);
        }
        
        function saveUsersToStorage() { localStorage.setItem('koreanFood_users', JSON.stringify(appState.users)); }
        function saveCurrentUserToStorage() { localStorage.setItem('koreanFood_currentUser', JSON.stringify(appState.currentUser)); }
        function saveSalesToStorage() { localStorage.setItem('koreanFood_sales', JSON.stringify(appState.sales)); }
        function saveMaterialsToStorage() { localStorage.setItem('koreanFood_materials', JSON.stringify(appState.materials)); }
        function saveSettingsToStorage() { localStorage.setItem('koreanFood_settings', JSON.stringify(appState.settings)); }
        function saveThemeToStorage() { localStorage.setItem('koreanFood_darkMode', JSON.stringify(appState.darkMode)); }
        
        function initCharts() {
            const salesCtx = document.getElementById('salesChart').getContext('2d');
            salesChart = new Chart(salesCtx, {
                type: 'line', data: { labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'], datasets: [{
                    label: 'Revenue', data: [0, 0, 0, 0, 0, 0], backgroundColor: 'rgba(39, 174, 96, 0.2)',
                    borderColor: '#27ae60', borderWidth: 2, tension: 0.3, fill: true
                }, {
                    label: 'Profit', data: [0, 0, 0, 0, 0, 0], backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: '#3498db', borderWidth: 2, tension: 0.3, fill: true
                }]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
            
            const reportCtx = document.getElementById('reportChart').getContext('2d');
            reportChart = new Chart(reportCtx, {
                type: 'bar', data: { labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'], datasets: [{
                    label: 'Revenue', data: [0, 0, 0, 0], backgroundColor: '#2c3e50'
                }, { label: 'Material Cost', data: [0, 0, 0, 0], backgroundColor: '#e74c3c' }]},
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }
        
        function login(username, password) {
            const user = appState.users.find(u => u.username === username && u.password === password);
            if (user) {
                appState.currentUser = user;
                saveCurrentUserToStorage();
                currentUsername.textContent = user.username;
                showMainApp();
                showToast('Login successful! Welcome to Korean Food Business Management.', 'success');
            } else showToast('Invalid username or password', 'danger');
        }
        
        function logout() {
            appState.currentUser = null;
            localStorage.removeItem('koreanFood_currentUser');
            showLoginScreen();
            showToast('You have been logged out.', 'info');
        }
        
        function showLoginScreen() { loginScreen.classList.remove('d-none'); mainApp.classList.add('d-none'); }
        function showMainApp() { loginScreen.classList.add('d-none'); mainApp.classList.remove('d-none'); }
        
        function navigateToPage(page) {
            sidebarLinks.forEach(link => {
                link.classList.toggle('active', link.getAttribute('data-page') === page);
            });
            pages.forEach(p => p.classList.toggle('d-none', p.id !== `${page}Page`));
            appState.currentPage = page;
            if (page === 'dashboard') updateDashboardData('today');
        }
        
        function updateDashboardData(period) {
            let filteredSales = filterSalesByPeriod(appState.sales, period);
            let totalRevenue = 0, totalMaterialCost = 0, totalProfit = 0, totalSales = filteredSales.length;
            filteredSales.forEach(sale => {
                totalRevenue += sale.total;
                totalMaterialCost += sale.materialCost;
                totalProfit += sale.profit;
            });
            
            document.querySelector('.kpi-card.revenue .kpi-value').textContent = totalRevenue.toFixed(2);
            document.querySelector('.kpi-card.cost .kpi-value').textContent = totalMaterialCost.toFixed(2);
            document.querySelector('.kpi-card.profit .kpi-value').textContent = totalProfit.toFixed(2);
            document.querySelector('.kpi-card.sales .kpi-value').textContent = totalSales;
            
            updateTopSellingItems(filteredSales);
            updateRecentSales(filteredSales);
            updateLowStockAlerts();
            updateChartData(filteredSales);
        }
        
        function filterSalesByPeriod(sales, period) {
            const now = new Date(); let startDate;
            switch(period) {
                case 'today': startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate()); break;
                case 'week': startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 7); break;
                case 'month': startDate = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate()); break;
                case 'year': startDate = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate()); break;
                default: return sales;
            }
            return sales.filter(sale => new Date(sale.date) >= startDate);
        }
        
        function updateTopSellingItems(sales) {
            const topSellingContainer = document.getElementById('topSellingItems');
            if (sales.length === 0) {
                topSellingContainer.innerHTML = '<div class="empty-state"><i class="bi bi-graph-up"></i><p>No sales data available</p></div>';
                return;
            }
            const materialCounts = {};
            sales.forEach(sale => sale.items.forEach(item => {
                materialCounts[item.materialName] = (materialCounts[item.materialName] || 0) + item.quantity;
            }));
            const sortedMaterials = Object.entries(materialCounts).sort((a, b) => b[1] - a[1]).slice(0, 5);
            if (sortedMaterials.length === 0) {
                topSellingContainer.innerHTML = '<div class="empty-state"><i class="bi bi-graph-up"></i><p>No top selling items data</p></div>';
                return;
            }
            let itemsHTML = '';
            sortedMaterials.forEach(([name, quantity]) => {
                itemsHTML += `<div class="d-flex justify-content-between align-items-center mb-2 p-2 border-bottom"><span>${name}</span><span class="badge bg-primary">${quantity}</span></div>`;
            });
            topSellingContainer.innerHTML = itemsHTML;
        }
        
        function updateRecentSales(sales) {
            const recentSalesContainer = document.getElementById('recentSales');
            if (sales.length === 0) {
                recentSalesContainer.innerHTML = '<div class="empty-state"><i class="bi bi-cart-check"></i><p>No recent sales</p></div>';
                return;
            }
            const recentSales = sales.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            let salesHTML = '';
            recentSales.forEach(sale => {
                salesHTML += `<div class="d-flex justify-content-between align-items-center mb-2 p-2 border-bottom">
                    <div><div class="fw-bold">${sale.id}</div><small class="text-muted">${sale.date}</small></div>
                    <div class="text-end"><div class="fw-bold currency">${sale.total.toFixed(2)}</div><small class="text-success">Profit: ${appState.currencySymbol}${sale.profit.toFixed(2)}</small></div></div>`;
            });
            recentSalesContainer.innerHTML = salesHTML;
        }
        
        function updateLowStockAlerts() {
            const lowStockContainer = document.getElementById('lowStockAlerts');
            const lowStockMaterials = appState.materials.filter(m => m.stock <= appState.settings.lowStockThreshold);
            if (lowStockMaterials.length === 0) {
                lowStockContainer.innerHTML = '<div class="empty-state"><i class="bi bi-check-circle"></i><p>No low stock alerts</p></div>';
                return;
            }
            let alertsHTML = '';
            lowStockMaterials.forEach(material => {
                alertsHTML += `<div class="alert alert-warning d-flex align-items-center" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i><div>${material.name} is running low (${material.stock} remaining)</div></div>`;
            });
            lowStockContainer.innerHTML = alertsHTML;
        }
        
        function updateChartData(sales) {
            const monthlyData = calculateMonthlyData(sales);
            salesChart.data.datasets[0].data = monthlyData.revenue;
            salesChart.data.datasets[1].data = monthlyData.profit;
            salesChart.update();
            const weeklyData = calculateWeeklyData(sales);
            reportChart.data.datasets[0].data = weeklyData.revenue;
            reportChart.data.datasets[1].data = weeklyData.cost;
            reportChart.update();
        }
        
        function calculateMonthlyData(sales) {
            const revenue = [0, 0, 0, 0, 0, 0], profit = [0, 0, 0, 0, 0, 0];
            sales.forEach(sale => {
                const month = new Date(sale.date).getMonth();
                if (month >= 0 && month <= 5) {
                    revenue[month] += sale.total;
                    profit[month] += sale.profit;
                }
            });
            return { revenue, profit };
        }
        
        function calculateWeeklyData(sales) {
            const revenue = [0, 0, 0, 0], cost = [0, 0, 0, 0];
            sales.forEach(sale => {
                const dayOfMonth = new Date(sale.date).getDate();
                let week = Math.floor((dayOfMonth - 1) / 7);
                revenue[week] += sale.total;
                cost[week] += sale.materialCost;
            });
            return { revenue, cost };
        }
        
        function updateSalesTable() {
            const salesTableBody = document.getElementById('salesTableBody');
            if (appState.sales.length === 0) {
                salesTableBody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">No sales records found</td></tr>';
                return;
            }
            let salesHTML = '';
            appState.sales.forEach(sale => {
                salesHTML += `<tr>
                    <td>${sale.id}</td><td>${sale.date}</td><td>${sale.customer || 'N/A'}</td><td>${sale.items.length}</td>
                    <td class="currency">${sale.total.toFixed(2)}</td><td class="currency">${sale.materialCost.toFixed(2)}</td><td class="currency">${sale.profit.toFixed(2)}</td>
                    <td><button class="btn btn-sm btn-outline-primary edit-sale" data-id="${sale.id}"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-sm btn-outline-danger delete-sale" data-id="${sale.id}"><i class="bi bi-trash"></i></button></td></tr>`;
            });
            salesTableBody.innerHTML = salesHTML;
            document.querySelectorAll('.edit-sale').forEach(btn => btn.addEventListener('click', function() { editSale(this.getAttribute('data-id')); }));
            document.querySelectorAll('.delete-sale').forEach(btn => btn.addEventListener('click', function() { if(confirm('Are you sure?')) deleteSale(this.getAttribute('data-id')); }));
        }
        
        function updateMaterialsTable() {
            const materialsTableBody = document.getElementById('materialsTableBody');
            if (appState.materials.length === 0) {
                materialsTableBody.innerHTML = '<tr><td colspan="8" class="text-center text-muted py-4">No materials found</td></tr>';
                return;
            }
            let materialsHTML = '';
            appState.materials.forEach(material => {
                const stockBadge = material.stock <= appState.settings.lowStockThreshold ? 
                    `<span class="badge badge-low-stock">${material.stock}</span>` : `<span class="badge bg-success">${material.stock}</span>`;
                materialsHTML += `<tr>
                    <td>${material.id}</td><td>${material.name}</td><td>${material.category}</td><td>${stockBadge}</td>
                    <td class="currency">${material.boxPrice.toFixed(2)}</td><td>${material.piecesPerBox}</td><td class="currency">${material.costPerPiece.toFixed(2)}</td>
                    <td><button class="btn btn-sm btn-outline-primary edit-material" data-id="${material.id}"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-sm btn-outline-danger delete-material" data-id="${material.id}"><i class="bi bi-trash"></i></button></td></tr>`;
            });
            materialsTableBody.innerHTML = materialsHTML;
            document.querySelectorAll('.edit-material').forEach(btn => btn.addEventListener('click', function() { editMaterial(this.getAttribute('data-id')); }));
            document.querySelectorAll('.delete-material').forEach(btn => btn.addEventListener('click', function() { if(confirm('Are you sure?')) deleteMaterial(this.getAttribute('data-id')); }));
        }
        
        function populateMaterialSelects() {
            document.querySelectorAll('.material-select').forEach(select => {
                while (select.options.length > 1) select.remove(1);
                appState.materials.forEach(material => {
                    const option = document.createElement('option');
                    option.value = material.id; option.textContent = material.name;
                    select.appendChild(option);
                });
            });
        }
        
        function addSaleItem() {
            const saleItems = document.getElementById('saleItems');
            const newRow = document.createElement('tr'); newRow.className = 'sale-item-row';
            newRow.innerHTML = `<td><select class="form-select material-select"><option selected>Select Material</option></select></td>
                <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>`;
            saleItems.appendChild(newRow);
            populateSingleMaterialSelect(newRow.querySelector('.material-select'));
            newRow.querySelector('.remove-item').addEventListener('click', function() { newRow.remove(); calculateSaleTotals(); });
            newRow.querySelector('.quantity').addEventListener('input', calculateSaleTotals);
            newRow.querySelector('.material-select').addEventListener('change', calculateSaleTotals);
        }
        
        function addEditSaleItem() {
            const editSaleItems = document.getElementById('editSaleItems');
            const newRow = document.createElement('tr'); newRow.className = 'sale-item-row';
            newRow.innerHTML = `<td><select class="form-select material-select"><option selected>Select Material</option></select></td>
                <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td>`;
            editSaleItems.appendChild(newRow);
            populateSingleMaterialSelect(newRow.querySelector('.material-select'));
            newRow.querySelector('.remove-item').addEventListener('click', function() { newRow.remove(); calculateEditSaleTotals(); });
            newRow.querySelector('.quantity').addEventListener('input', calculateEditSaleTotals);
            newRow.querySelector('.material-select').addEventListener('change', calculateEditSaleTotals);
        }
        
        function populateSingleMaterialSelect(selectElement) {
            while (selectElement.options.length > 1) selectElement.remove(1);
            appState.materials.forEach(material => {
                const option = document.createElement('option');
                option.value = material.id; option.textContent = material.name;
                selectElement.appendChild(option);
            });
        }
        
        function calculateSaleTotals() {
            let materialCost = 0;
            document.querySelectorAll('#saleItems tr').forEach(row => {
                const materialSelect = row.querySelector('.material-select');
                const materialId = materialSelect.value;
                const material = appState.materials.find(m => m.id === materialId);
                if (material && materialId !== 'Select Material') {
                    const itemQuantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    materialCost += material.costPerPiece * itemQuantity;
                }
            });
            const salePrice = parseFloat(document.getElementById('salePrice').value) || 0;
            const profit = salePrice - materialCost;
            document.getElementById('saleMaterialCost').textContent = materialCost.toFixed(2);
            document.getElementById('salePriceDisplay').textContent = salePrice.toFixed(2);
            document.getElementById('saleProfit').textContent = profit.toFixed(2);
        }
        
        function calculateEditSaleTotals() {
            let materialCost = 0;
            document.querySelectorAll('#editSaleItems tr').forEach(row => {
                const materialSelect = row.querySelector('.material-select');
                const materialId = materialSelect.value;
                const material = appState.materials.find(m => m.id === materialId);
                if (material && materialId !== 'Select Material') {
                    const itemQuantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    materialCost += material.costPerPiece * itemQuantity;
                }
            });
            const salePrice = parseFloat(document.getElementById('editSalePrice').value) || 0;
            const profit = salePrice - materialCost;
            document.getElementById('editSaleMaterialCost').textContent = materialCost.toFixed(2);
            document.getElementById('editSalePriceDisplay').textContent = salePrice.toFixed(2);
            document.getElementById('editSaleProfit').textContent = profit.toFixed(2);
        }
        
        function calculateCostPerPiece() {
            const boxPrice = parseFloat(document.getElementById('boxPrice').value) || 0;
            const piecesPerBox = parseFloat(document.getElementById('piecesPerBox').value) || 0;
            document.getElementById('costPerPiece').value = piecesPerBox > 0 ? (boxPrice / piecesPerBox).toFixed(2) : '0.00';
        }
        
        function calculateEditCostPerPiece() {
            const boxPrice = parseFloat(document.getElementById('editBoxPrice').value) || 0;
            const piecesPerBox = parseFloat(document.getElementById('editPiecesPerBox').value) || 0;
            document.getElementById('editCostPerPiece').value = piecesPerBox > 0 ? (boxPrice / piecesPerBox).toFixed(2) : '0.00';
        }
        
        function saveSale() {
            const saleDate = document.getElementById('saleDate').value;
            const customer = document.getElementById('customer').value;
            const items = []; let materialCost = 0;
            
            document.querySelectorAll('#saleItems tr').forEach(row => {
                const materialSelect = row.querySelector('.material-select');
                const materialId = materialSelect.value;
                const material = appState.materials.find(m => m.id === materialId);
                if (material && materialId !== 'Select Material') {
                    const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    items.push({ materialId, materialName: material.name, quantity, cost: material.costPerPiece * quantity });
                    materialCost += material.costPerPiece * quantity;
                    material.stock -= quantity;
                }
            });
            
            if (items.length === 0) { showToast('Please add at least one material to the sale', 'warning'); return; }
            
            const salePrice = parseFloat(document.getElementById('salePrice').value) || 0;
            if (salePrice <= 0) { showToast('Please enter a valid sale price', 'warning'); return; }
            
            const profit = salePrice - materialCost;
            const sale = { id: 'S' + Date.now(), date: saleDate, customer, items, total: salePrice, materialCost, profit };
            appState.sales.push(sale);
            saveSalesToStorage(); saveMaterialsToStorage();
            updateDashboardData('today'); updateSalesTable(); updateMaterialsTable();
            bootstrap.Modal.getInstance(document.getElementById('addSaleModal')).hide();
            showToast('Sale saved successfully!', 'success');
            document.getElementById('saleForm').reset();
            document.getElementById('saleDate').valueAsDate = new Date();
            document.getElementById('saleItems').innerHTML = `<tr class="sale-item-row">
                <td><select class="form-select material-select"><option selected>Select Material</option></select></td>
                <td><input type="number" class="form-control quantity" value="1" min="1"></td>
                <td><button type="button" class="btn btn-sm btn-danger remove-item"><i class="bi bi-trash"></i></button></td></tr>`;
            populateMaterialSelects(); calculateSaleTotals();
        }
        
        function saveMaterial() {
            const name = document.getElementById('materialName').value;
            const category = document.getElementById('materialCategory').value;
            const stock = parseInt(document.getElementById('materialStock').value) || 0;
            const unit = document.getElementById('materialUnit').value;
            const boxPrice = parseFloat(document.getElementById('boxPrice').value) || 0;
            const piecesPerBox = parseInt(document.getElementById('piecesPerBox').value) || 0;
            const costPerPiece = parseFloat(document.getElementById('costPerPiece').value) || 0;
            
            if (!name || !category || !unit || !boxPrice || !piecesPerBox) {
                showToast('Please fill in all required fields', 'warning'); return;
            }
            
            const material = { id: 'M' + Date.now(), name, category, stock, unit, boxPrice, piecesPerBox, costPerPiece };
            appState.materials.push(material);
            saveMaterialsToStorage();
            updateMaterialsTable(); populateMaterialSelects();
            bootstrap.Modal.getInstance(document.getElementById('addMaterialModal')).hide();
            showToast('Material saved successfully!', 'success');
            document.getElementById('materialForm').reset();
        }
        
        function editSale(saleId) {
            const sale = appState.sales.find(s => s.id === saleId);
            if (sale) {
                appState.editingSale = sale;
                document.getElementById('editSaleId').value = sale.id;
                document.getElementById('editSaleDate').value = sale.date;
                document.getElementById('editCustomer').value = sale.customer || '';
                document.getElementById('editSalePrice').value = sale.total;
                document.getElementById('editSaleItems').innerHTML = '';
                sale.items.forEach(item => {
                    addEditSaleItem();
                    const lastRow = document.querySelector('#editSaleItems tr:last-child');
                    const material = appState.materials.find(m => m.id === item.materialId);
                    if (lastRow && material) {
                        lastRow.querySelector('.material-select').value = item.materialId;
                        lastRow.querySelector('.quantity').value = item.quantity;
                    }
                });
                calculateEditSaleTotals();
                new bootstrap.Modal(document.getElementById('editSaleModal')).show();
            }
        }
        
        function updateSale() {
            if (!appState.editingSale) return;
            const saleId = document.getElementById('editSaleId').value;
            const saleDate = document.getElementById('editSaleDate').value;
            const customer = document.getElementById('editCustomer').value;
            const items = []; let materialCost = 0;
            
            document.querySelectorAll('#editSaleItems tr').forEach(row => {
                const materialSelect = row.querySelector('.material-select');
                const materialId = materialSelect.value;
                const material = appState.materials.find(m => m.id === materialId);
                if (material && materialId !== 'Select Material') {
                    const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
                    items.push({ materialId, materialName: material.name, quantity, cost: material.costPerPiece * quantity });
                    materialCost += material.costPerPiece * quantity;
                }
            });
            
            if (items.length === 0) { showToast('Please add at least one material to the sale', 'warning'); return; }
            
            const salePrice = parseFloat(document.getElementById('editSalePrice').value) || 0;
            if (salePrice <= 0) { showToast('Please enter a valid sale price', 'warning'); return; }
            
            const profit = salePrice - materialCost;
            const saleIndex = appState.sales.findIndex(s => s.id === saleId);
            if (saleIndex !== -1) {
                appState.sales[saleIndex] = { ...appState.sales[saleIndex], date: saleDate, customer, items, total: salePrice, materialCost, profit };
                saveSalesToStorage();
                updateDashboardData('today'); updateSalesTable();
                bootstrap.Modal.getInstance(document.getElementById('editSaleModal')).hide();
                showToast('Sale updated successfully!', 'success');
            }
        }
        
        function editMaterial(materialId) {
            const material = appState.materials.find(m => m.id === materialId);
            if (material) {
                appState.editingMaterial = material;
                document.getElementById('editMaterialId').value = material.id;
                document.getElementById('editMaterialName').value = material.name;
                document.getElementById('editMaterialCategory').value = material.category;
                document.getElementById('editMaterialStock').value = material.stock;
                document.getElementById('editMaterialUnit').value = material.unit;
                document.getElementById('editBoxPrice').value = material.boxPrice;
                document.getElementById('editPiecesPerBox').value = material.piecesPerBox;
                document.getElementById('editCostPerPiece').value = material.costPerPiece;
                new bootstrap.Modal(document.getElementById('editMaterialModal')).show();
            }
        }
        
        function updateMaterial() {
            if (!appState.editingMaterial) return;
            const materialId = document.getElementById('editMaterialId').value;
            const name = document.getElementById('editMaterialName').value;
            const category = document.getElementById('editMaterialCategory').value;
            const stock = parseInt(document.getElementById('editMaterialStock').value) || 0;
            const unit = document.getElementById('editMaterialUnit').value;
            const boxPrice = parseFloat(document.getElementById('editBoxPrice').value) || 0;
            const piecesPerBox = parseInt(document.getElementById('editPiecesPerBox').value) || 0;
            const costPerPiece = parseFloat(document.getElementById('editCostPerPiece').value) || 0;
            
            if (!name || !category || !unit || !boxPrice || !piecesPerBox) {
                showToast('Please fill in all required fields', 'warning'); return;
            }
            
            const materialIndex = appState.materials.findIndex(m => m.id === materialId);
            if (materialIndex !== -1) {
                appState.materials[materialIndex] = { ...appState.materials[materialIndex], name, category, stock, unit, boxPrice, piecesPerBox, costPerPiece };
                saveMaterialsToStorage();
                updateMaterialsTable(); populateMaterialSelects();
                bootstrap.Modal.getInstance(document.getElementById('editMaterialModal')).hide();
                showToast('Material updated successfully!', 'success');
            }
        }
        
        function deleteSale(saleId) {
            appState.sales = appState.sales.filter(s => s.id !== saleId);
            saveSalesToStorage(); updateSalesTable(); updateDashboardData('today');
            showToast('Sale deleted successfully!', 'success');
        }
        
        function deleteMaterial(materialId) {
            appState.materials = appState.materials.filter(m => m.id !== materialId);
            saveMaterialsToStorage(); updateMaterialsTable(); populateMaterialSelects();
            showToast('Material deleted successfully!', 'success');
        }
        
        function loadSettingsForm() {
            document.getElementById('companyName').value = appState.settings.companyName;
            document.getElementById('taxRate').value = appState.settings.taxRate;
            document.getElementById('lowStockAlert').checked = appState.settings.lowStockAlert;
            document.getElementById('lowStockThreshold').value = appState.settings.lowStockThreshold;
        }
        
        function saveSettings() {
            appState.settings.companyName = document.getElementById('companyName').value;
            appState.settings.taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            appState.settings.lowStockAlert = document.getElementById('lowStockAlert').checked;
            appState.settings.lowStockThreshold = parseInt(document.getElementById('lowStockThreshold').value) || 10;
            saveSettingsToStorage(); showToast('Settings saved successfully!', 'success');
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
        }
        
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            document.getElementById('reportTitle').textContent = reportType.charAt(0).toUpperCase() + reportType.slice(1) + ' Report';
            
            let filteredData = appState.sales;
            if (dateFrom && dateTo) {
                filteredData = appState.sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate >= new Date(dateFrom) && saleDate <= new Date(dateTo);
                });
            }
            
            let totalRevenue = 0, totalMaterialCost = 0, totalProfit = 0;
            filteredData.forEach(sale => {
                totalRevenue += sale.total; totalMaterialCost += sale.materialCost; totalProfit += sale.profit;
            });
            
            document.querySelector('.revenue.currency').textContent = totalRevenue.toFixed(2);
            document.querySelector('.cost.currency').textContent = totalMaterialCost.toFixed(2);
            document.querySelector('.profit.currency').textContent = totalProfit.toFixed(2);
            updateReportChart(filteredData);
            showToast('Report generated successfully!', 'success');
        }
        
        function updateReportChart(filteredData) {
            const weeklyData = calculateWeeklyData(filteredData);
            reportChart.data.datasets[0].data = weeklyData.revenue;
            reportChart.data.datasets[1].data = weeklyData.cost;
            reportChart.update();
        }
        
        function exportToCsv() {
            let csvContent = "data:text/csv;charset=utf-8,ID,Date,Customer,Items,Total,Material Cost,Profit\n";
            appState.sales.forEach(sale => {
                csvContent += `${sale.id},${sale.date},${sale.customer || 'N/A'},${sale.items.length},${sale.total},${sale.materialCost},${sale.profit}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri); link.setAttribute("download", "sales_data.csv");
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
            showToast('CSV file downloaded successfully!', 'success');
        }
        
        function exportToPdf() {
            const { jsPDF } = window.jspdf; const doc = new jsPDF();
            doc.setFontSize(20); doc.text('Korean Food Business Sales Report', 20, 20);
            doc.setFontSize(12); doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 30);
            const tableColumn = ["ID", "Date", "Customer", "Items", "Total", "Material Cost", "Profit"];
            const tableRows = appState.sales.map(sale => [
                sale.id, sale.date, sale.customer || 'N/A', sale.items.length.toString(),
                `${appState.currencySymbol}${sale.total.toFixed(2)}`, `${appState.currencySymbol}${sale.materialCost.toFixed(2)}`, `${appState.currencySymbol}${sale.profit.toFixed(2)}`
            ]);
            doc.autoTable({ head: [tableColumn], body: tableRows, startY: 40, styles: { fontSize: 10 }, headStyles: { fillColor: [44, 62, 80] } });
            doc.save('korean_food_sales_report.pdf'); showToast('PDF report downloaded successfully!', 'success');
        }
        
        function searchSales() {
            const query = document.getElementById('salesSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#salesTableBody tr'); let hasResults = false;
            rows.forEach(row => {
                const show = row.textContent.toLowerCase().includes(query);
                row.style.display = show ? '' : 'none'; if (show) hasResults = true;
            });
            if (!hasResults) document.getElementById('salesTableBody').innerHTML = `<tr><td colspan="8" class="text-center text-muted py-4">No sales records found matching "${query}"</td></tr>`;
        }
        
        function searchMaterials() {
            const query = document.getElementById('materialsSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#materialsTableBody tr'); let hasResults = false;
            rows.forEach(row => {
                const show = row.textContent.toLowerCase().includes(query);
                row.style.display = show ? '' : 'none'; if (show) hasResults = true;
            });
            if (!hasResults) document.getElementById('materialsTableBody').innerHTML = `<tr><td colspan="8" class="text-center text-muted py-4">No materials found matching "${query}"</td></tr>`;
        }
        
        function downloadAllData() {
            const data = { users: appState.users, sales: appState.sales, materials: appState.materials, settings: appState.settings };
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a'); link.href = url; link.download = 'korean_food_data.json';
            document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url);
            showToast('All data downloaded successfully!', 'success');
        }
        
        function uploadData(event) {
            const file = event.target.files[0]; if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.users && data.sales && data.materials && data.settings) {
                        appState.users = data.users; appState.sales = data.sales; appState.materials = data.materials; appState.settings = data.settings;
                        saveUsersToStorage(); saveSalesToStorage(); saveMaterialsToStorage(); saveSettingsToStorage();
                        updateDashboardData('today'); updateSalesTable(); updateMaterialsTable(); populateMaterialSelects(); loadSettingsForm();
                        showToast('Data uploaded successfully!', 'success');
                    } else showToast('Invalid data file format', 'danger');
                } catch (error) { showToast('Error parsing data file', 'danger'); }
            };
            reader.readAsText(file); event.target.value = '';
        }
        
        function showDeleteConfirmation() {
            const confirmationModal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            confirmationModal.show(); document.getElementById('confirmDeleteInput').value = '';
            document.getElementById('confirmDeleteBtn').disabled = true;
        }
        
        function deleteAllData() {
            localStorage.removeItem('koreanFood_sales'); localStorage.removeItem('koreanFood_materials'); localStorage.removeItem('koreanFood_settings');
            appState.sales = []; appState.materials = [];
            appState.settings = { companyName: 'Korean Food Business', taxRate: 12, lowStockAlert: true, lowStockThreshold: 10 };
            saveSettingsToStorage(); updateDashboardData('today'); updateSalesTable(); updateMaterialsTable(); loadSettingsForm();
            bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal')).hide();
            bootstrap.Modal.getInstance(document.getElementById('settingsModal')).hide();
            showToast('All data has been deleted successfully!', 'success');
        }
        
        function toggleDarkMode() {
            appState.darkMode = !appState.darkMode; applyTheme(); saveThemeToStorage();
        }
        
        function applyTheme() {
            if (appState.darkMode) {
                document.body.classList.add('dark-mode'); themeToggle.innerHTML = '<i class="bi bi-sun"></i>';
            } else {
                document.body.classList.remove('dark-mode'); themeToggle.innerHTML = '<i class="bi bi-moon"></i>';
            }
        }
        
        function showToast(message, type = 'info', duration = 5000) {
            toastMessage.innerHTML = message;
            const toastHeader = toastEl.querySelector('.toast-header'); toastHeader.className = 'toast-header';
            if (type === 'success') toastHeader.classList.add('text-success');
            else if (type === 'warning') toastHeader.classList.add('text-warning');
            else if (type === 'danger') toastHeader.classList.add('text-danger');
            else toastHeader.classList.add('text-primary');
            toast._config.delay = duration; toast.show();
        }
    </script>
</body>
</html>